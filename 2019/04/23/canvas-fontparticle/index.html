<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="keywords" content="没事儿,tong-h,Tong-H,tong-h blog"><meta name="descriptioon" content="personal blog by tong/没事儿"><meta name="renderer" content="wekit"><link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/css/public.css"><link rel="stylesheet" href="/css/reset.css"><link rel="stylesheet" href="/css/iconfont.css"><title>canvas 文字粒子特效 [ 没事儿 ]</title><link rel="stylesheet" href="/css/partial/sidebar.css"><link rel="stylesheet" href="/css/post.css"></head><body class="scroll"><link rel="stylesheet" href="/css/partial/header.css"><div class="header"><div class="maxwidth"><div class="nav"><a id="artlist" href="/archives"><i class="iconfont iconArchives"></i><span class="headhid">&nbsp;Archives</span></a><a id="artlist" href="/about"><i class="iconfont iconAbout"></i><span class="headhid">&nbsp;About</span></a><a id="artlist" href="/404"><i class="iconfont iconCommonweal"></i><span class="headhid">&nbsp;Commonweal</span></a></div><div class="search">It's more tiring to stop</div></div></div><div class="line"></div><div class="main"> <div class="maxwidth"><link rel="stylesheet" href="/css/partial/sidebar.css"><div id="sidebar"><div class="info"><a href="/"><img src="/images/user.png" alt="头像"></a><div><p>没事儿</p></div></div><div class="social"><a href="/archives" title="Home"><i class="iconfont iconHome"></i></a><a href="/atom.xml" title="RSS 源订阅"><i class="iconfont iconsubscribe-1-copy"></i></a><a href="mailto:tongt0232@gmail.com" title="E-Mail"><i class="iconfont iconweibiaoti554"></i></a><a href="https://github.com/tong-h" title="GitHub"><i class="iconfont iconGitHub"></i></a><a href="https://www.jianshu.com/u/20de04cc53de" title="简书"><img src="/images/jianicon-sidebar.png"></a></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/WEB/">WEB</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/rests/">rests</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tool/">tool</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a><span class="category-list-count">1</span></li></ul><div class="tags"><a href="/tags/ECharts/" style="font-size: 14px; color: #ffac00">ECharts</a> <a href="/tags/Electron/" style="font-size: 14px; color: #ffac00">Electron</a> <a href="/tags/JSON/" style="font-size: 14px; color: #ffac00">JSON</a> <a href="/tags/angular/" style="font-size: 22px; color: #da8d00">angular</a> <a href="/tags/canvas/" style="font-size: 22px; color: #da8d00">canvas</a> <a href="/tags/cordova/" style="font-size: 30px; color: #b46e00">cordova</a> <a href="/tags/ffmpeg/" style="font-size: 14px; color: #ffac00">ffmpeg</a> <a href="/tags/git/" style="font-size: 14px; color: #ffac00">git</a> <a href="/tags/hexo/" style="font-size: 14px; color: #ffac00">hexo</a> <a href="/tags/http/" style="font-size: 14px; color: #ffac00">http</a> <a href="/tags/markdown/" style="font-size: 14px; color: #ffac00">markdown</a> <a href="/tags/mpvue/" style="font-size: 14px; color: #ffac00">mpvue</a> <a href="/tags/mysql/" style="font-size: 14px; color: #ffac00">mysql</a> <a href="/tags/nginx/" style="font-size: 14px; color: #ffac00">nginx</a> <a href="/tags/nodejs/" style="font-size: 14px; color: #ffac00">nodejs</a> <a href="/tags/npm/" style="font-size: 14px; color: #ffac00">npm</a> <a href="/tags/python/" style="font-size: 14px; color: #ffac00">python</a> <a href="/tags/rests/" style="font-size: 14px; color: #ffac00">rests</a> <a href="/tags/search/" style="font-size: 14px; color: #ffac00">search</a> <a href="/tags/vue/" style="font-size: 14px; color: #ffac00">vue</a> <a href="/tags/yarn/" style="font-size: 14px; color: #ffac00">yarn</a> <a href="/tags/原型链/" style="font-size: 14px; color: #ffac00">原型链</a> <a href="/tags/服务器/" style="font-size: 14px; color: #ffac00">服务器</a> <a href="/tags/死磕英语/" style="font-size: 14px; color: #ffac00">死磕英语</a> <a href="/tags/缓存/" style="font-size: 14px; color: #ffac00">缓存</a> <a href="/tags/网络爬虫/" style="font-size: 22px; color: #da8d00">网络爬虫</a> <a href="/tags/跨域/" style="font-size: 14px; color: #ffac00">跨域</a></div></div><div class="post rightside"><div class="title">canvas 文字粒子特效</div><div class="info"><i class="iconfont iconchakan"><span id="busuanzi_container_site_pv">  <span id="busuanzi_value_site_pv"></span> </span></i><i class="iconfont iconwenzi">13637</i><i class="iconfont iconshijian"><span>2019-04-23</span><span>&emsp;</span><span>2019-05-14</span></i></div><div class="postDetail"><p>一个文字粒子效果,折腾了一些时间，纯粹觉得好玩 <a href="https://tong-h.github.io/canvas-store/fontparticle/index.html" target="_blank" rel="noopener">点这里看效果</a></p>
<h2 id="随机初始化部分粒子"><a href="#随机初始化部分粒子" class="headerlink" title="随机初始化部分粒子"></a>随机初始化部分粒子</h2><p>1、首先要明白每个粒子都是一个对象，都有自己的移动轨迹，起点，移动速度，终点</p>
<p>2、粒子活动轨迹：初始化 —- 聚合拼合文字形状 —- 散开 —- 再聚合 —- 散开…</p>
<p>3、我们需要根据动画时间调整粒子移动的速度来安排他们的位置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.startx = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * docsize[<span class="number">0</span>]),   <span class="comment">// 初始起点</span></span><br><span class="line">        <span class="keyword">this</span>.starty = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * docsize[<span class="number">1</span>]),</span><br><span class="line">        <span class="keyword">this</span>.speedx = (<span class="built_in">Math</span>.random() * <span class="number">2</span> - <span class="number">1</span>) * pointspeed,     <span class="comment">// 移动速度</span></span><br><span class="line">        <span class="keyword">this</span>.speedy = (<span class="built_in">Math</span>.random() * <span class="number">2</span> - <span class="number">1</span>) * pointspeed, </span><br><span class="line">        <span class="keyword">this</span>.endx = <span class="number">0</span>,                                          <span class="comment">// 终点</span></span><br><span class="line">        <span class="keyword">this</span>.endy = <span class="number">0</span>,</span><br><span class="line">        <span class="keyword">this</span>.color = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">5</span>)              <span class="comment">// 粒子颜色</span></span><br><span class="line">    &#125;</span><br><span class="line">    endpoint(x, y) &#123;</span><br><span class="line">        <span class="keyword">this</span>.endx = x</span><br><span class="line">        <span class="keyword">this</span>.endy = y</span><br><span class="line">    &#125;</span><br><span class="line">    animal() &#123;</span><br><span class="line">        <span class="keyword">this</span>.startx += <span class="keyword">this</span>.speedx</span><br><span class="line">        <span class="keyword">this</span>.starty += <span class="keyword">this</span>.speedy</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 到达边界改变粒子运动方向</span></span><br><span class="line">        <span class="keyword">this</span>.speedx *= <span class="keyword">this</span>.startx &gt; docsize[<span class="number">0</span>] || <span class="keyword">this</span>.startx &lt; <span class="number">0</span> ? <span class="number">-1</span> : <span class="number">1</span></span><br><span class="line">        <span class="keyword">this</span>.speedy *= <span class="keyword">this</span>.starty &gt; docsize[<span class="number">1</span>] || <span class="keyword">this</span>.starty &lt; <span class="number">0</span> ? <span class="number">-1</span> : <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调整点的移动速度用以聚和拼合文字</span></span><br><span class="line">        <span class="keyword">if</span>(time === <span class="number">100</span> || time === <span class="number">600</span> || time === <span class="number">1100</span>) &#123; </span><br><span class="line">            <span class="keyword">this</span>.speedx = (<span class="keyword">this</span>.endx - <span class="keyword">this</span>.startx) / joinspeed</span><br><span class="line">            <span class="keyword">this</span>.speedy = (<span class="keyword">this</span>.endy - <span class="keyword">this</span>.starty) / joinspeed</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 到达终点后静止不动</span></span><br><span class="line">        <span class="keyword">if</span>(time === <span class="number">100</span> + joinspeed || time === <span class="number">600</span> + joinspeed || time === <span class="number">1100</span> + joinspeed) &#123;</span><br><span class="line">            <span class="keyword">this</span>.speedx = <span class="number">0</span></span><br><span class="line">            <span class="keyword">this</span>.speedy = <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 散开</span></span><br><span class="line">        <span class="keyword">if</span>(time === <span class="number">300</span> || time === <span class="number">800</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.speedx = (<span class="built_in">Math</span>.random() * <span class="number">2</span> - <span class="number">1</span>) * pointspeed</span><br><span class="line">            <span class="keyword">this</span>.speedy = (<span class="built_in">Math</span>.random() * <span class="number">2</span> - <span class="number">1</span>) * pointspeed</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        maincontent.beginPath()</span><br><span class="line">        maincontent.fillStyle = color[<span class="keyword">this</span>.color]</span><br><span class="line">        maincontent.arc(<span class="keyword">this</span>.startx, <span class="keyword">this</span>.starty, <span class="number">7</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI * <span class="number">2</span>)</span><br><span class="line">        maincontent.fill()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用-canvas-画板生成文字"><a href="#使用-canvas-画板生成文字" class="headerlink" title="使用 canvas 画板生成文字"></a>使用 canvas 画板生成文字</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 【文字面积，循环时用于判读y轴高度，粒子大小间隔， 文字宽度】</span></span><br><span class="line"><span class="keyword">let</span> [imgdata, cyclic, size, textwith] = [&#123;&#125;, <span class="number">1</span>, <span class="number">16</span>, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">textcontext.font = <span class="string">"normal 900 "</span> + fontsize +<span class="string">"px Avenir, Helvetica Neue, Helvetica, Arial, sans-serif"</span></span><br><span class="line">textwith = <span class="built_in">Math</span>.floor(textcontext.measureText(text).width)</span><br><span class="line">textcontext.fillStyle = <span class="string">'#ff0000'</span></span><br><span class="line">textcontext.fillText(text, (docsize[<span class="number">0</span>] - textwith) / <span class="number">2</span>, (docsize[<span class="number">1</span>]) / <span class="number">2</span>)</span><br><span class="line">textwith = ~~ (textwith) * size + size</span><br></pre></td></tr></table></figure>
<h2 id="遍历-imageData-获取文字区域的像素坐标"><a href="#遍历-imageData-获取文字区域的像素坐标" class="headerlink" title="遍历 imageData 获取文字区域的像素坐标"></a>遍历 imageData 获取文字区域的像素坐标</h2><p>不了解 imagedata 怎么用？ 看看这篇文章<a href="https://tong-h.github.io/2019/02/21/canvas-1/#more" target="_blank" rel="noopener">cannvas的imagedata对象</a></p>
<p>获取坐标这里有很多种方法，我看了一些教程好像没人像我这么写，要注意的是</p>
<ul>
<li>imageData 4个元素为一个像素，也就是一个R G B A 值，A 是 alpha 透明度</li>
<li>空白的区域rgba就是 0,0,0,0 , 文字区域就是有颜色的如果你没有设置字体颜色默认是黑色 rgba 就是 0,0,0,255，通过判断第四个元素可以获取文字区域</li>
<li>但是我建议重新设置一个其他的颜色比如红色 255,0,0,255，用第1个和2个数字来判断这样字体边缘会圆滑些，因为在字体边缘黑色和白色的交界处可能有某几个像素不是透明的</li>
<li>每个坐标最后都会生成一个圆，所以这里获取的是圆心的坐标，圆之间还需要留有空隙，所以遍历的时候你要根据你的圆的大小掌握好间隔</li>
<li>获取文字区域粒子数量后需要判断，目前屏幕上现有的粒子是否足够拼合和文字或者是否还需再添加粒子</li>
<li>确定粒子数量后再将文字坐标作为粒子移动终点赋值给粒子</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取文字所在区域，尽可能减小面积</span></span><br><span class="line">imgdata = textcontext.getImageData(<span class="number">0</span>,<span class="number">0</span>, textwith, fontsize * <span class="number">2</span>)</span><br><span class="line">textcontext.clearRect(<span class="number">0</span>, <span class="number">0</span>, docsize[<span class="number">0</span>], docsize[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// 粒子圆心坐标，粒子数组</span></span><br><span class="line"><span class="keyword">let</span> [x, y, len] = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历data数据查找文字所在的坐标</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; imgdata.data.length; i += size * <span class="number">4</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (imgdata.data[i] === <span class="number">255</span> &amp;&amp; imgdata.data[i+<span class="number">3</span>] === <span class="number">255</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断当前粒子数量是否能够拼合文字</span></span><br><span class="line">        <span class="keyword">if</span> (len &gt; pointarr.length - <span class="number">1</span>) pointarr.push(<span class="keyword">new</span> Point)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取每个粒子聚拢的终点</span></span><br><span class="line">        pointarr[len].endpoint(i /<span class="number">4</span> % textwith, cyclic)</span><br><span class="line">        len ++</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (i/<span class="number">4</span> == cyclic * textwith) &#123;</span><br><span class="line">        cyclic += size</span><br><span class="line">        i = textwith * (cyclic<span class="number">-1</span>) * <span class="number">4</span></span><br><span class="line">    &#125;·</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pointarr.length - <span class="number">1</span> - len &gt; <span class="number">0</span> ? pointarr.splice(len, pointarr.length - len) : <span class="string">''</span></span><br></pre></td></tr></table></figure>
<h2 id="源码带有详细的注解点这儿"><a href="#源码带有详细的注解点这儿" class="headerlink" title="源码带有详细的注解点这儿"></a>源码带有详细的注解<a href="https://tong-h.github.io/canvas-store/roundPercent/index.html" target="_blank" rel="noopener">点这儿</a></h2><p><a href="https://github.com/Tong-H/canvas-store" target="_blank" rel="noopener">更多效果</a><br>开源不易，觉得还不错点个 start 吧 (´▽`ʃ♡ƪ)</p>
</div><div class="copyright">转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达，可以联系我</div></div></div></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>var _hmt = _hmt || [];(function(){var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?a4d08c5088ca0d4b18c14260c9ca89a1";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})()</script></body></html>
<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="keywords" content="没事儿,tong-h,Tong-H,tong-h blog"><meta name="descriptioon" content="personal blog by tong/没事儿"><meta name="renderer" content="wekit"><link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/css/public.css"><link rel="stylesheet" href="/css/reset.css"><link rel="stylesheet" href="/css/iconfont.css"><script async src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script><title>博客 [ 没事儿 ]</title><link rel="stylesheet" href="/css/partial/footer.css"><link rel="stylesheet" href="/css/partial/posts.css"><link rel="stylesheet" href="/css/partial/posts.css"><link rel="stylesheet" href="/css/partial/sidebar.css"><link rel="stylesheet" href="/css/archive.css"><link rel="stylesheet" href="/css/index.css"></head><body class="scroll"><link rel="stylesheet" href="/css/partial/header.css"><div class="header"><div class="maxwidth"><div class="nav"><a id="artlist" href="/404"><i class="iconfont icon404"></i><span class="headhid">&nbsp;404</span></a><a id="artlist" href="/archives"><i class="iconfont iconarchives"></i><span class="headhid">&nbsp;博 客</span></a><a id="artlist" href="/about"><i class="iconfont iconabout"></i><span class="headhid">&nbsp;关 于</span></a><a id="artlist" href="/link"><i class="iconfont iconlink"></i><span class="headhid">&nbsp;友 链</span></a></div><div class="search">It's more tiring to stop</div></div></div><div class="line"></div><div class="main"> <div class="maxwidth"><link rel="stylesheet" href="/css/partial/sidebar.css"><div id="sidebar"><div class="info"><a href="/"><img src="/images/user.png" alt="头像"></a><div><p>没事儿</p></div></div><div class="social"><a href="/archives" title="Home"><i class="iconfont iconHome"></i></a><a href="/atom.xml" title="RSS 源订阅"><i class="iconfont iconsubscribe-1-copy"></i></a><a href="mailto:tongt0232@gmail.com" title="E-Mail"><i class="iconfont iconweibiaoti554"></i></a><a href="https://github.com/tong-h" title="GitHub"><i class="iconfont iconGitHub"></i></a><a href="https://www.jianshu.com/u/20de04cc53de" title="简书"><img src="/images/jianicon-sidebar.png"></a></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/MYSQL/">MYSQL</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PYTHON/">PYTHON</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/RESTS/">RESTS</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SERVER/">SERVER</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/TOOL/">TOOL</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WEB/">WEB</a><span class="category-list-count">23</span></li></ul><div class="tags"><a href="/tags/ECharts/" style="font-size: 14px; color: #ffac00">ECharts</a> <a href="/tags/Electron/" style="font-size: 14px; color: #ffac00">Electron</a> <a href="/tags/JSON/" style="font-size: 14px; color: #ffac00">JSON</a> <a href="/tags/angular/" style="font-size: 18px; color: #ec9d00">angular</a> <a href="/tags/canvas/" style="font-size: 26px; color: #c77e00">canvas</a> <a href="/tags/cordova/" style="font-size: 30px; color: #b46e00">cordova</a> <a href="/tags/domain/" style="font-size: 14px; color: #ffac00">domain</a> <a href="/tags/ffmpeg/" style="font-size: 14px; color: #ffac00">ffmpeg</a> <a href="/tags/git/" style="font-size: 14px; color: #ffac00">git</a> <a href="/tags/hexo/" style="font-size: 22px; color: #da8d00">hexo</a> <a href="/tags/http/" style="font-size: 14px; color: #ffac00">http</a> <a href="/tags/markdown/" style="font-size: 14px; color: #ffac00">markdown</a> <a href="/tags/mpvue/" style="font-size: 14px; color: #ffac00">mpvue</a> <a href="/tags/mysql/" style="font-size: 14px; color: #ffac00">mysql</a> <a href="/tags/nginx/" style="font-size: 14px; color: #ffac00">nginx</a> <a href="/tags/nodejs/" style="font-size: 14px; color: #ffac00">nodejs</a> <a href="/tags/npm/" style="font-size: 14px; color: #ffac00">npm</a> <a href="/tags/python/" style="font-size: 14px; color: #ffac00">python</a> <a href="/tags/rests/" style="font-size: 14px; color: #ffac00">rests</a> <a href="/tags/search/" style="font-size: 14px; color: #ffac00">search</a> <a href="/tags/server/" style="font-size: 14px; color: #ffac00">server</a> <a href="/tags/vue/" style="font-size: 14px; color: #ffac00">vue</a> <a href="/tags/yarn/" style="font-size: 14px; color: #ffac00">yarn</a> <a href="/tags/原型链/" style="font-size: 14px; color: #ffac00">原型链</a> <a href="/tags/死磕英语/" style="font-size: 14px; color: #ffac00">死磕英语</a> <a href="/tags/缓存/" style="font-size: 14px; color: #ffac00">缓存</a> <a href="/tags/网络爬虫/" style="font-size: 18px; color: #ec9d00">网络爬虫</a> <a href="/tags/跨域/" style="font-size: 14px; color: #ffac00">跨域</a></div></div><div class="archive rightside"><div id="list_archives" style="opacity: 0;display:  none"><div class="switch" id="arshow"><i class="iconfont iconArchives"></i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">3</span></li></ul></div><div id="normalposts"><div class="switch" id="poshow"><i class="iconfont iconshijian"></i></div><article><a class="artititle" href="/2019/03/01/googleSearch/">google 搜索语法</a><div class="content ellipse"><p></p><p>现在越来越习惯用google了，不是我嫌弃百度，只是用了google发现百度真的让人爱不起来，没有对比就没有伤害</p>
<p>收集了一些google常用的语法，备忘</p>
<p>这些是已经被弃用的：+、~、inpostauthor:、allinpostauthor:、inposttitle:、link:、info:、daterange:、phonebook:、#</p>
<p>这些是在被弃用边缘，搜索结果不是非常准确的</p>
<table>
<thead>
<tr>
<th style="text-align:center">symbol</th>
<th style="text-align:left">example</th>
<th style="text-align:left">explain</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">..</td>
<td style="text-align:left">apple 2010..2014</td>
<td style="text-align:left">范围搜索，返回2010到2014，不超过2015的信息</td>
</tr>
<tr>
<td style="text-align:center">inanchor:</td>
<td style="text-align:left">inanchor：apple iphone</td>
<td style="text-align:left">返回锚文本中包含指定词汇的页面</td>
</tr>
<tr>
<td style="text-align:center">allinanchor:</td>
<td style="text-align:left">inanchor：apple iphone</td>
<td style="text-align:left">和inanchor类似，返回锚文本中包含所有指定词汇的页面</td>
</tr>
<tr>
<td style="text-align:center">blogurl:</td>
<td style="text-align:left">blogurl：阮一峰</td>
<td style="text-align:left">谷歌博客搜索</td>
</tr>
<tr>
<td style="text-align:center">loc:</td>
<td style="text-align:left">loc:san francisco</td>
<td style="text-align:left">查找给定区域的结果</td>
</tr>
</tbody>
</table>
<p>以下是谷歌最新的常用搜索语法，帮助你更快找到你要的信息</p>
<table>
<thead>
<tr>
<th style="text-align:center">symbol</th>
<th style="text-align:left">example</th>
<th style="text-align:left">explain</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"> OR或者管道符号（竖线）</td>
<td style="text-align:left">x OR y</td>
<td style="text-align:left">返回x或者y的信息，或者和两者都相关的信息</td>
</tr>
<tr>
<td style="text-align:center"> AND</td>
<td style="text-align:left">x AND y</td>
<td style="text-align:left">返回和两者都相关的信息</td>
</tr>
<tr>
<td style="text-align:center"> - 短横线</td>
<td style="text-align:left">x -y</td>
<td style="text-align:left">排除一个相似的容易造成误导的词语，返回x相关的信息而不是y，注意: 符号-和y之间没有空格</td>
</tr>
<tr>
<td style="text-align:center"> * 通配符</td>
<td style="text-align:left">x * y</td>
<td style="text-align:left">匹配任何信息</td>
</tr>
<tr>
<td style="text-align:center"> () 括号</td>
<td style="text-align:left">(x OR y) -z</td>
<td style="text-align:left">将多个款项和符号组合搜索</td>
</tr>
<tr>
<td style="text-align:center"> $ 美元符号</td>
<td style="text-align:left">iphone $2000</td>
<td style="text-align:left">价格搜索</td>
</tr>
<tr>
<td style="text-align:center"> define:</td>
<td style="text-align:left">define:china</td>
<td style="text-align:left">显示谷歌内置的词典，以卡片形式展现</td>
</tr>
<tr>
<td style="text-align:center"> cache:</td>
<td style="text-align:left">cache:<a href="https://github.com" target="_blank" rel="noopener">https://github.com</a></td>
<td style="text-align:left">返回该页面最新缓存版本</td>
</tr>
<tr>
<td style="text-align:center"> filetype: 或者 ext:</td>
<td style="text-align:left">个人简历 filetype:pdf</td>
<td style="text-align:left">返回符合指定的文件类型的信息</td>
</tr>
<tr>
<td style="text-align:center"> site:</td>
<td style="text-align:left">js site:github.com</td>
<td style="text-align:left">将搜索限制在某个指定的网站</td>
</tr>
<tr>
<td style="text-align:center"> related:</td>
<td style="text-align:left">related:github.com</td>
<td style="text-align:left">查找和给定域名相关的站点</td>
</tr>
<tr>
<td style="text-align:center"> intitle:</td>
<td style="text-align:left">intitle:github</td>
<td style="text-align:left">返回所有标题中包含“github”的信息</td>
</tr>
<tr>
<td style="text-align:center"> allintitle:</td>
<td style="text-align:left">allintitle:github js</td>
<td style="text-align:left">和intitle类似，返回标题中包含所有单词的信息</td>
</tr>
<tr>
<td style="text-align:center"> inurl:</td>
<td style="text-align:left">inurl:github</td>
<td style="text-align:left">和intitle类似，不同的是匹配的是url而不是标题</td>
</tr>
<tr>
<td style="text-align:center"> allinurl</td>
<td style="text-align:left">allinurl:github js</td>
<td style="text-align:left">同上</td>
</tr>
<tr>
<td style="text-align:center"> intext:</td>
<td style="text-align:left">intext:github</td>
<td style="text-align:left">和intitle类似，不同的是匹配的是内容而不是标题</td>
</tr>
<tr>
<td style="text-align:center"> allintext:</td>
<td style="text-align:left">allintext:github js</td>
<td style="text-align:left">同上</td>
</tr>
<tr>
<td style="text-align:center"> AROUND(X)</td>
<td style="text-align:left">apple AROUND（4）iphone</td>
<td style="text-align:left">间隔限制，单词“apple”和“iphone”必须出现在内容中，并且相隔不超过四个单词。</td>
</tr>
<tr>
<td style="text-align:center"> weather:</td>
<td style="text-align:left">weather:san francisco</td>
<td style="text-align:left">查找指定位置的天气</td>
</tr>
<tr>
<td style="text-align:center"> stocks:</td>
<td style="text-align:left">stocks:aapl</td>
<td style="text-align:left">查找指定的股票信息</td>
</tr>
<tr>
<td style="text-align:center"> map:</td>
<td style="text-align:left">map:silicon valley</td>
<td style="text-align:left">地图搜索</td>
</tr>
<tr>
<td style="text-align:center"> movie:</td>
<td style="text-align:left">movie:steve jobs</td>
<td style="text-align:left">电影搜索</td>
</tr>
<tr>
<td style="text-align:center"> in</td>
<td style="text-align:left">$329 in GBP</td>
<td style="text-align:left">单位转换，前者向后者转换</td>
</tr>
<tr>
<td style="text-align:center"> source:</td>
<td style="text-align:left">apple source:the_verge</td>
<td style="text-align:left">在google News中查找来自某个来源的新闻</td>
</tr>
</tbody>
</table>
<p></p></div><div class="meta"><i class="iconfont iconweibiaoti--" title="阅读时长">2</i><i class="iconfont iconwenzi" title="字数">634</i><i class="iconfont iconshijian" title="创建时间">2019-03-01 15:04</i></div></article><article><a class="artititle" href="/2019/02/21/canvas-1/">cannvas的imagedata对象</a><div class="content ellipse"><p></p><h2 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h2><p>ImageData 是canvas的图像数据，由<strong> ImageData() </strong>构造函数返回一个实例化的对象，<strong> 三个可读属性 </strong> </p>
<ul>
<li><p>data：一个 Uint8ClampedArray 类型的一维数组，包含RGBA 顺序的数据，每4个元素表示一个RGBA 值即对应一个像素, 左上角在数组的索引0位置，像素从左到右被处理，然后往下，遍历整个数组<br><strong> RGBA：</strong> R - 红色（0-255）、G - 绿色（0-255）、B - 蓝色（0-255）、A - alpha 通道（0-255; 0 是透明的，255 是完全可见的）<br><strong>  Uint8ClampedArray（8位无符号整型固定数组）：</strong> 类型化数组表示一个由值固定在0-255区间的8位无符号整型组成的数组；如果你指定一个在 [0,255] 区间外的值，它将被替换为0或255；如果你指定一个非整数，那么它将被设置为最接近它的整数。（数组）内容被初始化为0。</p>
</li>
<li><p>width：以像素为单位的图像的宽</p>
</li>
<li><p>height：以像素为单位的图像的高</p>
</li>
</ul>
<p><strong> 三个参数的关系是：data.length = height * width * 4 </strong><br>不满足这个关系的时候就会报错：” The input data length is not a multiple of (4 * width).” ，不要问我为什么知道</p>
<h2 id="构建一个ImageData-对象"><a href="#构建一个ImageData-对象" class="headerlink" title="构建一个ImageData 对象"></a>构建一个ImageData 对象</h2><h3 id="使用canvas-API"><a href="#使用canvas-API" class="headerlink" title="使用canvas API"></a>使用canvas API</h3><p><strong> createImageData(): 传入宽和高获得一个ImageData对象或者传入一个已经存在的ImageData对象渲染到画布 </strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"canvas"</span>)</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.getContext(<span class="string">"2d"</span>)</span><br><span class="line"><span class="built_in">console</span>.log(ctx.createImageData(<span class="number">200</span>, <span class="number">200</span>))</span><br></pre></td></tr></table></figure></p>
<p><strong> getImageData(): 提取一个矩形区域的图像数据，返回一个ImageData对象 </strong><br>ctx.getImageData(矩形区域的左上角 x 坐标, 矩形区域的左上角 y 坐标, 矩形区域的宽度, 矩形区域的高度)<br>下面是一个简单的小例子让div背景色随着鼠标指针下的图片颜色变化而变化，思路是使用 getImageData() 获取鼠标下1像素的区域，也就是一个RGBA值赋值给div<br>运行时注意canvas图片使用 getImageData() 的跨域问题<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> img = <span class="keyword">new</span> Image()</span><br><span class="line">img.src = <span class="string">'./static/img/1547436818106.png'</span></span><br><span class="line"><span class="keyword">let</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>)</span><br><span class="line"><span class="keyword">let</span> ctx = canvas.getContext(<span class="string">'2d'</span>)</span><br><span class="line">img.onload = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  ctx.drawImage(img, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">  img.style.display = <span class="string">'none'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> color = <span class="built_in">document</span>.getElementById(<span class="string">'color'</span>)</span><br><span class="line">canvas.addEventListener(<span class="string">'mousemove'</span>, (e) =&gt;&#123;</span><br><span class="line">  <span class="keyword">let</span> pixel = ctx.getImageData(e.layerx, e.layery, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">  color.style.background =  <span class="string">'rgba('</span> + pixel.data[<span class="number">0</span>] + <span class="string">','</span> + pixel.data[<span class="number">1</span>] + <span class="string">','</span> + pixel.data[<span class="number">2</span>] + <span class="string">','</span> + (pixel.data[<span class="number">3</span>] / <span class="number">255</span>) + <span class="string">')'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h3 id="直接使用ImageData-构造函数创建-data可为空"><a href="#直接使用ImageData-构造函数创建-data可为空" class="headerlink" title="直接使用ImageData()构造函数创建, data可为空"></a>直接使用ImageData()构造函数创建, data可为空</h3><p>当data为空时会自动按照width和height的大小，以0填充整个像素矩阵，也就是一个空白画布<br>若需要传入data图像数据，要注意 width * height * 4 = data.length<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> imagedata = <span class="keyword">new</span> ImageData(data, width, height)</span><br><span class="line"><span class="comment">// ImageData &#123; width: width, height: height, data: Uint8ClampedArray[width * height * 4] &#125;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="操作像素"><a href="#操作像素" class="headerlink" title="操作像素"></a>操作像素</h2><p><strong> putImageData(): 对画布进行像素数据的写入，也就是将指定的 ImageData 对象放到画布上，7个参数，前3个为必填 </strong><br>ctx.putImageData(imagedata, 图像数据在目标画布中的位置X坐标, Y坐标, 在图像数据中截取一个矩形区域左上角的位置X坐标, Y坐标, 矩形区域Width, Height);<br>一个小例子图片灰度处理，思路是使用 getImageData() 获取当前 ImageData 数据，然后遍历 data 数组改变 RGBA 的值，最后在使用 putImageData() 放回画布<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> img = <span class="keyword">new</span> Image()</span><br><span class="line">img.src = <span class="string">'./static/img/shareedu.png'</span></span><br><span class="line"><span class="keyword">let</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>)</span><br><span class="line"><span class="keyword">let</span> ctx = canvas.getContext(<span class="string">'2d'</span>)</span><br><span class="line">img.onload = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  ctx.drawImage(img, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">  img.style.display = <span class="string">'none'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'btn'</span>).addEventListener(<span class="string">'click'</span>, ()=&gt;&#123;</span><br><span class="line">  <span class="keyword">let</span> pre = ctx.getImageData(<span class="number">0</span>,<span class="number">0</span>,canvas.width, canvas.height)</span><br><span class="line">  <span class="keyword">let</span> data = pre.data</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.length; i += <span class="number">4</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> avg = (data[i] + data[i +<span class="number">1</span>] + data[i +<span class="number">2</span>]) / <span class="number">3</span></span><br><span class="line">    data[i] = avg</span><br><span class="line">    data[i + <span class="number">1</span>] = avg</span><br><span class="line">    data[i + <span class="number">2</span>] = avg</span><br><span class="line">  &#125;</span><br><span class="line">  ctx.putImageData(pre, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p><strong> drawImage(): 在画布上绘制图像，9个参数，image, dx, dy为必填 </strong><br>image: 图像源<br>sx: 选择需要的图像源区域，矩形选择框的左上角 X 轴坐标。<br>sy:  矩形选择框的Y 轴坐标。<br>sWidth: 需要绘制到目标上下文中的，image的矩形（裁剪）选择框的宽度。如果不说明，整个矩形（裁剪）从坐标的sx和sy开始，到image的右下角结束。<br>sHeight: 需要绘制到目标上下文中的，image的矩形（裁剪）选择框的高度。<br>dx: image的左上角在目标canvas上 X 轴坐标。<br>dy: image的左上角在目标canvas上 Y 轴坐标。<br>dWidth: image在目标canvas上绘制的宽度。 允许对绘制的image进行缩放<br>dHeight: image在目标canvas上绘制的高度。 允许对绘制的image进行缩放<br>一个小例子将图片放在鼠标指定位置<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"canvas"</span>)</span><br><span class="line"><span class="keyword">let</span> ctx = canvas.getContext(<span class="string">"2d"</span>)</span><br><span class="line"><span class="keyword">let</span> img = <span class="keyword">new</span> Image()</span><br><span class="line">img.src = <span class="string">'./static/img/shareedu.png'</span></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>).addEventListener(<span class="string">'mousedown'</span>, (e)=&gt;&#123;</span><br><span class="line">  ctx.clearRect(<span class="number">0</span>,<span class="number">0</span>,ctx.canvas.width,ctx.canvas.height)</span><br><span class="line">  ctx.drawImage(img, e.offsetX, e.offsetY, <span class="number">200</span>, <span class="number">200</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p><strong> imageSmoothingEnabled, 这是个属性设置图片是否平滑，只需要将他赋值为true（平滑）或者false（不平滑） </strong></p>
<p><strong> canvas.toDataURL(‘image/png’, quality) 返回一个包含图片展示的 data URI , 2个参数, 图片格式默认为png, 0到1的品质选择（图片格式为 image/jpeg 或 image/webp的情况下） </strong></p>
<p><strong> canvas.toBlob(callback, type, encoderOptions),创建一个Blob对像，用以展示canvas上的图片，3个参数 </strong><br>callback：回调函数返回一个blob对象<br>type：图片格式，默认为’image/png’<br>encoderOptions:  0到1的品质选择（图片格式为 image/jpeg 或 image/webp的情况下）</p>
<h1 id="一些canvas的小例子"><a href="#一些canvas的小例子" class="headerlink" title="一些canvas的小例子"></a>一些canvas的小例子</h1><p>自己学习过程中用canvas写的一些小东西，源码带有注解给大家参考，会坚持不断更新这个目录….</p>
<p><strong><a href="https://tong-h.github.io/canvas-store/roundPercent/index.html" target="_blank" rel="noopener">环形百分比动画</a></strong><br><img src="https://tong-h.github.io/canvas-store/roundPercent/img.png" alt="示例图片"><br><strong><a href="https://tong-h.github.io/canvas-store/particle/index.html" target="_blank" rel="noopener">粒子动画</a></strong><br><img src="https://tong-h.github.io/canvas-store/particle/img.png" alt="示例图片"><br><strong><a href="https://tong-h.github.io/canvas-store/draw/index.html" target="_blank" rel="noopener">电子画板</a></strong><br><img src="https://tong-h.github.io/canvas-store/draw/img.png" alt="示例图片"><br><strong><a href="https://tong-h.github.io/canvas-store/imgcut/index.html" target="_blank" rel="noopener">图片裁剪</a></strong><br><img src="https://tong-h.github.io/canvas-store/imgcut/img.png" alt="示例图片"></p>
<h1 id="本站和canvas有关的文章"><a href="#本站和canvas有关的文章" class="headerlink" title="本站和canvas有关的文章"></a>本站和canvas有关的文章</h1><p><strong><a href="https://tong-h.github.io/2019/03/07/canvas-2/#more" target="_blank" rel="noopener">canvas动画篇</a></strong></p>
<p></p></div><div class="meta"><i class="iconfont iconweibiaoti--" title="阅读时长">5</i><i class="iconfont iconwenzi" title="字数">1.4k</i><i class="iconfont iconshijian" title="创建时间">2019-02-21 15:43</i></div></article><article><a class="artititle" href="/2018/12/13/electron/">Electron踩坑指南不完全篇</a><div class="content ellipse"><p></p><p>前段时间做了个客户端的项目，主要适用于老师教案管理、远程上课录屏、和学生互动答疑等场景，原生开发对公司来说成本有点大，基于guthub上有各种桌面打包框架so只能前端上了</p>
<p>Electron + vue = product</p>
<p>这是一篇踩坑的记录，没有太深入的原理什么的讲解，主要是码代码过程中碰到的一些暗坑你如果正在写Electron的项目那么你也可能会遇到，这篇文章会给你一些参考</p>
<h1 id="为什么用Electron"><a href="#为什么用Electron" class="headerlink" title="为什么用Electron"></a>为什么用Electron</h1><p>这是目前大家知道比较多的三种跨平台的桌面框架<br>NWJS      <a href="https://nwjs.io/" target="_blank" rel="noopener">https://nwjs.io/</a><br>HEX       <a href="http://hex.youdao.com/zh-cn/tutorial/index.html" target="_blank" rel="noopener">http://hex.youdao.com/zh-cn/tutorial/index.html</a><br>Electron  <a href="https://Electronjs.org/docs" target="_blank" rel="noopener">https://Electronjs.org/docs</a></p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center"><strong> Electron </strong></th>
<th style="text-align:center"><strong> nw.js </strong></th>
<th style="text-align:center"><strong> hex </strong>  </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"> <strong> 发布时间 </strong></td>
<td style="text-align:center">2013年</td>
<td style="text-align:center">2011年</td>
<td style="text-align:center">2012年 </td>
</tr>
<tr>
<td style="text-align:center"> <strong> 开发公司 </strong></td>
<td style="text-align:center">github</td>
<td style="text-align:center">intel</td>
<td style="text-align:center">有道翻译 </td>
</tr>
<tr>
<td style="text-align:center"> <strong> 代表作 </strong></td>
<td style="text-align:center">Atom、Visual Studio Code 、WordPress</td>
<td style="text-align:center">微信web开发工具、钉钉</td>
<td style="text-align:center">有道云笔记，有道词典</td>
</tr>
<tr>
<td style="text-align:center"> <strong> github start </strong></td>
<td style="text-align:center">66608</td>
<td style="text-align:center">34555</td>
<td style="text-align:center">1429 </td>
</tr>
</tbody>
</table>
<p>三个框架都是 chromium + nodejs + native api ， 不用考虑浏览器兼容性还能用nodejs，简直不要太爽</p>
<ul>
<li>Chromium 是 Google 为发展 Chrome 浏览器而启动的开源项目，它对HTML5的支持非常优秀，其内嵌的V8引擎是业内效率最好的JavaScript脚本引擎之一，且其项目开源，又有专门的社区和团队维护，作为UI渲染引擎，它是不二之选，体验上，你可以试用下google chrome浏览器，基本一致</li>
<li>Node.js （或者简称 Node） 一个工具，选择Node.JS，是因为开发桌面应用，本地资源操作是必备的能力，这方面JavaScript无能为力，而Node.JS则很好的解决了这个问题，它使得JavaScript操作本地资源变的毫无障碍。另一方面，Node.JS核心也是采用V8引擎，使得其与Chromium的整合变得更顺理成章</li>
<li>API 应用程序接口描述了一系列可供你使用的函数库中的函数</li>
</ul>
<p>我绝对是有道词典的忠实用户但是hex用的人较少怕遇坑爬不出来，nwjs主要优点是能兼容winXP，但是我不需要。。。而且nw和Electron是同一个大佬一前一后开发，Electron相当于是nwjs的重构升级版，官网又这么好看又那么火，还犹豫？</p>
<h1 id="简单介绍"><a href="#简单介绍" class="headerlink" title="简单介绍"></a>简单介绍</h1><p>官网传送门</p>
<ul>
<li>官方api <a href="https://Electronjs.org/docs" target="_blank" rel="noopener">https://Electronjs.org/docs</a></li>
<li>Electron-vue文档 <a href="https://simulatedgreg.gitbooks.io/Electron-vue/content/cn/getting_started.html" target="_blank" rel="noopener">https://simulatedgreg.gitbooks.io/Electron-vue/content/cn/getting_started.html</a></li>
<li>中文社区文档<a href="https://Electron.org.cn/doc/index.html" target="_blank" rel="noopener">https://Electron.org.cn/doc/index.html</a></li>
</ul>
<p>常用的一些模块：</p>
<ul>
<li>文件打开删除等操作 shell模块  <a href="https://Electronjs.org/docs/api/shell" target="_blank" rel="noopener">https://Electronjs.org/docs/api/shell</a></li>
<li>窗口管理修改新建参数等 BrowserWindow模块  <a href="https://Electronjs.org/docs/api/browser-window" target="_blank" rel="noopener">https://Electronjs.org/docs/api/browser-window</a></li>
<li>主进程和渲染进程通信 ipcRenderer 模块   <a href="https://Electronjs.org/docs/api/ipc-renderer" target="_blank" rel="noopener">https://Electronjs.org/docs/api/ipc-renderer</a></li>
<li>获取屏幕大小、鼠标位置等信息 screen 模块  <a href="https://Electronjs.org/docs/api/screen" target="_blank" rel="noopener">https://Electronjs.org/docs/api/screen</a></li>
<li>渲染进程使用BrowserWindow 实例  remote模块  <a href="https://Electronjs.org/docs/api/remote" target="_blank" rel="noopener">https://Electronjs.org/docs/api/remote</a></li>
</ul>
<h1 id="暗-坑"><a href="#暗-坑" class="headerlink" title="暗 坑"></a>暗 坑</h1><p>Electron是个很成熟很完善的框架，所以这些也不叫暗坑，只是小白如果没有很仔细的阅读api就可能容易掉坑里，不要问我为什么知道，我是有故事的人</p>
<h2 id="Q、已经引了BrowserWindow-为什么使用函数会是undefined？"><a href="#Q、已经引了BrowserWindow-为什么使用函数会是undefined？" class="headerlink" title="Q、已经引了BrowserWindow 为什么使用函数会是undefined？"></a>Q、已经引了BrowserWindow 为什么使用函数会是undefined？</h2><p>A、Electron分为主进程和渲染进程，Electron 运行 package.json 的 main 脚本的进程被称为主进程只有一个，而渲染进程就是你的页面一个BrowserWindow 实例，所以api也分为主进程和渲染进程以及两者通用的api，所以用api的时候得注意，在渲染进程中使用 BrowserWindow 实例需要引入 remote 模块</p>
<p>主进程可用的模块:app、autoUpdate、BrowserView、BrowserWindow、contentTracing、dialog、globalShortcut、inAppPurchase、ipcMain、Menu、MenuItem、net、netLog、powerMonitor、powerSaveBlocker、protocol、session、systemPreferences、Tray、webContents<br>渲染进程（网页）可用的模块:、desktopCapturer、ipcRenderer、remote、webFrame<br>两种进程都可用的模块:、clipboard、crashReporter、nativeImage、screen、shell</p>
<h2 id="Q、想在渲染进程使用主进程的api？"><a href="#Q、想在渲染进程使用主进程的api？" class="headerlink" title="Q、想在渲染进程使用主进程的api？"></a>Q、想在渲染进程使用主进程的api？</h2><p>A、有某些功能必须得在主进程才能实现，比如保存文件、选择文件路径什么的，这些操作可以使用 ipcRenderer 模块用于两个进程之间的通信，由渲染进程发出指令后在主进程进行功能操作</p>
<h2 id="Q、单击PDF文件的链接时，Electron会提示下载而非直接预览？"><a href="#Q、单击PDF文件的链接时，Electron会提示下载而非直接预览？" class="headerlink" title="Q、单击PDF文件的链接时，Electron会提示下载而非直接预览？"></a>Q、单击PDF文件的链接时，Electron会提示下载而非直接预览？</h2><p>A、单击PDF文件的链接时，在普通浏览器中它会预览该文件。但在Electron中你需要尝试使用 iframe 加载，如果无效可以再试下 webview </p>
<h2 id="Q、动态的修改静态文件的路径会报链接404？"><a href="#Q、动态的修改静态文件的路径会报链接404？" class="headerlink" title="Q、动态的修改静态文件的路径会报链接404？"></a>Q、动态的修改静态文件的路径会报链接404？</h2><p>A、使用Electron-vue框架，动态的修改静态文件的路径会报链接404但是一开始写死就没问题，所有静态文件都建议放在根目录下 static 文件夹下，然后任何页面访问 static/… 即可</p>
<h2 id="Q、透明窗口无效？"><a href="#Q、透明窗口无效？" class="headerlink" title="Q、透明窗口无效？"></a>Q、透明窗口无效？</h2><p>A、新建窗口时已经设置了frame: false,transparent: true, 为什么页面还是白色，开发模式下看透明窗口需要关掉开发者模式后刷新</p>
<h2 id="Q、新建一个窗口，然后拖动该窗口，宽度和高度会小于指定值？"><a href="#Q、新建一个窗口，然后拖动该窗口，宽度和高度会小于指定值？" class="headerlink" title="Q、新建一个窗口，然后拖动该窗口，宽度和高度会小于指定值？"></a>Q、新建一个窗口，然后拖动该窗口，宽度和高度会小于指定值？</h2><p>A、 guthub上有大佬说setResizable: false下最小化且连续恢复，则窗口的高度每次都会减少一个看起来等于菜单栏的量，取消菜单后正常，设置window.setMenu(null)，但是这个方法对我不适用<br>在 issues上翻了一圈，最后 useContentSize: true设置为true + 更改width和height属性以适应测量大小 = 解决</p>
<h2 id="Q、navigator-mediaDevices-getUserMedia-使用该属性报错？"><a href="#Q、navigator-mediaDevices-getUserMedia-使用该属性报错？" class="headerlink" title="Q、navigator.mediaDevices.getUserMedia 使用该属性报错？"></a>Q、navigator.mediaDevices.getUserMedia 使用该属性报错？</h2><p>A、之前使用这个属性报错还以为Electron不支持，感觉很奇怪他继承的是最新的 chromium 为什么会不支持这个属性，然后某天翻api发现 desktopCapturer 模块，这个属性被Electron封装了，需要引入 desktopCapturer 模块，所以敲黑板一定要认真看api</p>
<h2 id="Q、打包问题？"><a href="#Q、打包问题？" class="headerlink" title="Q、打包问题？"></a>Q、打包问题？</h2><p>A、前端大部分框架都封装了webpack，glup什么的都有打包功能，然后一搜 “ 某某框架 打包 ” ，出来的都是什么打包报错？ 空白？一大堆问题，感觉这个问题好像无解<br>之前我写demo的时候打包各种报错，可能是因为写demo的时候各种实验各种乱搞把框架玩坏了，反正正式写项目的时候一个打包问题都没有碰到过<br>只是一点第一次打包的时候很慢，因为Electron需要翻墙下载文件，这时候如果打包失败，多半就是被墙了</p>
<h2 id="Q、’-’和’-‘符号路径问题"><a href="#Q、’-’和’-‘符号路径问题" class="headerlink" title="Q、’\’和’/‘符号路径问题"></a>Q、’\’和’/‘符号路径问题</h2><p>A、通过Electron获取的路径这样的’d:\project...’，本来挺好的文件保存读取什么的用这个路径都挺正常的，但是使用nodejs的exec库调取cmd执行ffmpeg的命令会报错，需要把路径分隔符’\’换成’/‘ </p>
<h2 id="Q、关于新建窗口时的白屏"><a href="#Q、关于新建窗口时的白屏" class="headerlink" title="Q、关于新建窗口时的白屏"></a>Q、关于新建窗口时的白屏</h2><p>A、新建窗口由于加载页面和初始化窗口会有一段时间的白屏，有个方法就是初始化程序的时候就加载的所有窗口，但是只显示主窗口,其余的窗口隐藏,这样就能有效创建窗口时的白屏</p>
<p></p></div><div class="meta"><i class="iconfont iconweibiaoti--" title="阅读时长">6</i><i class="iconfont iconwenzi" title="字数">1.8k</i><i class="iconfont iconshijian" title="创建时间">2018-12-13 17:57</i></div></article><article><a class="artititle" href="/2018/11/16/english-clockIn/">英语单词打卡记录</a><div class="content ellipse"><p></p><p>背单词接近3个月了，作为一个朝九晚六的上班族，一般背单词的时间是早上地铁有那么半个小时作为新单词时间然后晚上地铁半个小时是新单词为主 + 少部分需要复习的单词，然后睡觉前1个小时是单词复习时间。</p>
<p>平时的强度是每天新单词20个这个量其实不多，但是需要复习的单词平均每天有160个左右。<br>我背单词是用anki，个人感觉这是个相当好用的记忆软件，可以帮助你记忆生活任何知识，优点太多就不列举了。用过的小伙伴应该都知道anki根据记忆的遗忘曲线每天都会有需要复习的单词，随着每天持续的加入新单词那么每天需要复习的单词也会越来越多，但是如果每天都坚持背单词并把所有到期需要复习的单词清空掉那么每天需要复习的就不会有这么多。</p>
<p>但是人啊 (。_。) ，每个星期总有那么一两天各种原因理由(又出现一个大bug？、今天加班、状态不好、其他乱七八糟的事)就会忘了背或者没背完。到期的单词没有被清空就会堆积在第二天，但是第二天也会有单词到期，所以一般就是今天160没背完明天翻个番，眼看着数量越来越多就会越来越不想背然后拖到周末被一次性清空。</p>
<p>anki记忆卡有四个选项重来、困难、一般、简单，根据自己的记忆深度决定这个单词的到期时间，到时间就把这个单词牵出来遛一遛晃一晃加深印象。那么我一次性拖到周末虽然也背完了但非常不利于单词的记忆，这导致很多背过的单词再出现我会感觉很陌生这样效率就大大降低了。</p>
<hr>
<hr>
<hr>
<p></p></div><div class="meta"><i class="iconfont iconweibiaoti--" title="阅读时长">1</i><i class="iconfont iconwenzi" title="字数">526</i><i class="iconfont iconshijian" title="创建时间">2018-11-16 12:03</i></div></article><article><a class="artititle" href="/2018/11/06/streamcapture/">前端使用html5、ffmpeg实现录屏摄像等功能</a><div class="content ellipse"><p></p><p>前段时间做一个windows的桌面应用，vue + electron，涉及到录屏和摄像功能，网上相关的文档蛮少的给需要的人一些参考</p>
<p>如果文章描写有误或者还有更好的方法，请留言告诉我，笔芯 (´▽`ʃ♡ƪ)</p>
<h1 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h1><p><strong> 涉及技术：vue、electron、ffmpeg、node </strong></p>
<p>关于录屏和摄像对比了两种方法</p>
<ul>
<li><p>使用HTML5的api实现</p>
<p>摄像：mediaDevices（获取设备）+ getUserMedia（获取流） + MediaRecorder（存储）</p>
<p>录屏：getDisplayMedia（获取流） + MediaRecorder（存储）</p>
</li>
<li><p>ffmpeg + node：FFmpeg是一套非常强大的音视频处理的开源工具，不多介绍，而Electron基于node和chromium，它允许使用node的API以及几乎所有的node模块，这意味这着我们可以调用cmd命令来操作ffmpeg实现录屏和摄像录制，当然ffmpeg功能绝不止这点</p>
</li>
</ul>
<h1 id="HTML5实现"><a href="#HTML5实现" class="headerlink" title="HTML5实现"></a>HTML5实现</h1><h2 id="mediaDevices"><a href="#mediaDevices" class="headerlink" title="mediaDevices"></a>mediaDevices</h2><ul>
<li><p>用于收集系统上可用的多媒体输入和输出设备的信息</p>
</li>
<li><p>该方法调用成功返回设备列表，并传入带有devceID的MediaStreamConstraints对象可以指定设备获取流媒体来源</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">navigator.mediaDevices.enumerateDevices().then(<span class="function"><span class="params">devicelist</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// audiooutput 扬声器</span></span><br><span class="line">  <span class="comment">// audioinput  麦克风</span></span><br><span class="line">  <span class="comment">// audiooutput 摄像</span></span><br><span class="line">  <span class="built_in">console</span>.log(devicelist)</span><br><span class="line">&#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err))</span><br></pre></td></tr></table></figure>
<h2 id="getUserMedia"><a href="#getUserMedia" class="headerlink" title="getUserMedia"></a>getUserMedia</h2></li>
<li><p>用户提供访问硬件设备媒体（摄像头、视频、音频、地理位置等）的接口，基于该接口，开发者可以在不依赖任何浏览器插件的条件下访问硬件媒体设备。</p>
</li>
<li><p>该方法返回视频流，将获取到的流赋给video标签可实现边录边看</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">navigator.mediaDevices.getUserMedia(MediaStreamConstraints).then(<span class="function"><span class="params">stream</span> =&gt;</span> &#123;</span><br><span class="line">    videoElement.srcObject = stream; <span class="comment">// </span></span><br><span class="line">  &#125;, error =&gt; <span class="built_in">console</span>.log(error));</span><br></pre></td></tr></table></figure>
<h2 id="getDisplayMedia"><a href="#getDisplayMedia" class="headerlink" title="getDisplayMedia"></a>getDisplayMedia</h2></li>
<li><p>将用户的显示或其部分用作媒体流的来源，它允许以视频流的形式获取用户的显示器或其一部分</p>
</li>
<li><p>录屏主要依靠该方法，和getUserMedia一样返回一个promise对象，调用成功返回流，将这个流赋给video 元素实现边录边看</p>
</li>
<li><p><strong> 需要注意的是</strong> 如果你做的是网页端在谷歌上使用这个元素，需要在chrome://flags/开启Experimental Web Platform features功能<br><a href="https://tong-h.github.io/canvas-store/capture/index.html" target="_blank" rel="noopener">demo戳这儿</a></p>
<p>&emsp;&emsp;&emsp;&emsp;而Electron基于node + chromium构建，在electron需要引入desktopCapturer模块，并在基于该模块使用这个方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">navigator.mediaDevices.getDisplayMedia(&#123; <span class="attr">video</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">stream</span> =&gt;</span> &#123;</span><br><span class="line">    videoElement.srcObject = stream;</span><br><span class="line">  &#125;, error =&gt; <span class="built_in">console</span>.log(error));</span><br></pre></td></tr></table></figure>
<h2 id="MediaRecorder"><a href="#MediaRecorder" class="headerlink" title="MediaRecorder"></a>MediaRecorder</h2></li>
<li><p>记录和捕获媒体，也就是视频和音频</p>
</li>
<li><p>getDisplayMedia 和 getUserMedia 获取到的流都需要使用MediaRecorder存储起来，并且可以保存成文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> herf</span><br><span class="line"><span class="keyword">this</span>.recorder = <span class="keyword">new</span> MediaRecorder(stream);</span><br><span class="line"><span class="keyword">this</span>.recorder.ondataavailable = <span class="function"><span class="params">e</span> =&gt;</span> &#123; </span><br><span class="line">  herf = e.data;</span><br><span class="line">  download.href = URL.createObjectURL(herf);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">this</span>.recorder.start();</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="第二种使用ffmpeg"><a href="#第二种使用ffmpeg" class="headerlink" title="第二种使用ffmpeg"></a>第二种使用ffmpeg</h1><p>官网安装包下载 <a href="https://ffmpeg.zeranoe.com/builds/" target="_blank" rel="noopener">https://ffmpeg.zeranoe.com/builds/</a></p>
<p>一些基本参数</p>
<ul>
<li>-formats                输出所有可用格式</li>
<li>-f fmt                  指定格式(音频或视频格式)</li>
<li>-i filename              指定输入文件名，在linux下当然也能指定:0.0(屏幕录制)或摄像头</li>
<li>-y                      覆盖已有文件</li>
<li>-t duration              记录时长为t</li>
<li>-fs limit_size          设置文件大小上限</li>
<li>-itsoffset time_off      设置时间偏移(s)，该选项影响所有后面的输入文件。该偏移被加到输入文件的时戳，定义一个正偏移意味着相应的流被延迟了 offset秒。 [-]hh:mm:ss* [.xxx]的格式也支持<br>音 频</li>
<li>-ab bitrate           设置音频码率</li>
<li>-ar freq              设置音频采样率</li>
<li>-ac channels          设置通道 缺省为1<br>视 频</li>
<li>-b bitrate            设置比特率，缺省200kb/s</li>
<li>-r fps                设置帧频 缺省25</li>
<li>-s size               设置帧大小 格式为WXH 缺省160X128.下面的简写也可以直接使用：</li>
</ul>
<h2 id="录屏相关命令"><a href="#录屏相关命令" class="headerlink" title="录屏相关命令"></a>录屏相关命令</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">列出可用的设备包括音频和摄像等等</span><br><span class="line">ffmpeg -list_devices true -f dshow -<span class="selector-tag">i</span> dummy</span><br><span class="line"></span><br><span class="line">录屏，你也可以加入关于视频的一些基本参数来获得你想要的文件</span><br><span class="line">ffmpeg -f gdigrab -<span class="selector-tag">i</span> desktop captrue<span class="selector-class">.mkv</span> -y</span><br></pre></td></tr></table></figure>
<h2 id="node调用"><a href="#node调用" class="headerlink" title="node调用"></a>node调用</h2><p>cd进入bin文件夹后执行录屏相关命令</p>
<p>关于停止录制，虽然ffmpeg按 Q 可以停止录制，但是我们通过代码调用是看不到cmd命令行的而且他在录制过程中是一直占用这个进程什么命令也无法输入<br>所以这个地方我只想到一个办法就是强制停止该进程</p>
<p>参考文章</p>
<p>MDN <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/MediaDevices/getUserMedia" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/MediaDevices/getUserMedia</a><br>&emsp;<a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaRecorder" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/API/MediaRecorder</a><br>&emsp;<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/MediaDevices/enumerateDevices" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/MediaDevices/enumerateDevices</a></p>
<p>W3C <a href="https://w3c.github.io/mediacapture-screen-share/" target="_blank" rel="noopener">https://w3c.github.io/mediacapture-screen-share/</a></p>
<p></p></div><div class="meta"><i class="iconfont iconweibiaoti--" title="阅读时长">4</i><i class="iconfont iconwenzi" title="字数">1.1k</i><i class="iconfont iconshijian" title="创建时间">2018-11-06 17:05</i></div></article><article><a class="artititle" href="/2018/10/16/https/">前端是否需要对密码进行加密传输 &amp;&amp; HTTPS</a><div class="content ellipse"><p></p><p>最近学习node，写demo登陆和注册功能的时候因为要考虑后台的加密和安全所以也想了下前端的，前端传输密码的时候是否应该加密之后再传输呢<br>看了一些网站的登陆，csdn、简书等是明文传输，但腾讯、百度这些一线大站是经过前端加密的，看了些大佬的文章，顺便自己搬个凳子记个笔记</p>
<h1 id="前端是否需要对密码进行加密传输"><a href="#前端是否需要对密码进行加密传输" class="headerlink" title="前端是否需要对密码进行加密传输"></a>前端是否需要对密码进行加密传输</h1><p>前端的加密本身不能对网站的安全性有任何提高功能，所有的关于网站的安全技术都应该放在后台，但是这也不是完全没有意义，可以增加攻击成本，尽可能降低攻击带来的损失，毕竟丢了密文比丢了明文要强，而且犯罪分子技术参差不齐，简单的加密能够拦截很大一部分菜鸟，至于高手。。。</p>
<p>最后看到比较统一的是隐秘信息传输应该使用https</p>
<h1 id="什么是https-ssl证书又是什么"><a href="#什么是https-ssl证书又是什么" class="headerlink" title="什么是https? ssl证书又是什么"></a>什么是https? ssl证书又是什么</h1><p>这篇文章只是想弄懂流程和原理，不会去纠结具体的术语</p>
<p>HTTP协议以明文方式发送内容，不提供任何方式的数据加密，处在同一网络中的其它用户可以通过网络抓包来窃取和篡改数据包的内容，甚至运营商或者wifi提供者，有可能会篡改http报文，添加广告等信息以达到盈利的目的</p>
<p>可以通过和SSL(Secure Socket Layer，安全套接层)组合使用来为浏览器和服务器之间的通信加密。在这条加密线路上进行通信的http被称为HTTPS（HTTP Secure，超文本传输安全协议）。</p>
<p>SSL证书（Secure socket layer），就是遵守SSL协议，由受信任的数字证书颁发机构CA颁发，主要用来提供对用户浏览器和服务器的认证，对传送的数据进行加密和隐藏，确保数据在传送中不被改变保证数据的完整性，加密方式为「非对称加密」和「对称加密」。</p>
<h2 id="https的工作流程"><a href="#https的工作流程" class="headerlink" title="https的工作流程"></a>https的工作流程</h2><p>1、用户连接到你的Web站点，该Web站点受服务器证书所保护</p>
<p>2、你的服务器进行响应，并自动传送你网站的数字证书给用户，（浏览器内置一个受信任的机构列表和这些机构的证书）用户的浏览器查看该证书是否存在于浏览器的受信任机构列表中，并且通过服务器证书中的信息与当前正在访问的网站（域名等）是否一致来鉴别你的网站，鉴别没成功会提醒用户是否继续该访问</p>
<p>3、鉴别成功后，用户的浏览器产生一把唯一的会话钥匙，用以跟网站之间所有的通讯过程进行加密，会话密钥是随机生成，每次都会有不一样的结果，</p>
<p>4、使用者的浏览器以网站的公钥对交谈钥匙码进行加密，以便只有让你的网站得以阅读此交谈钥匙码</p>
<h2 id="https的优点："><a href="#https的优点：" class="headerlink" title="https的优点："></a>https的优点：</h2><p>1、使用HTTPS协议可认证用户和服务器，确保数据发送到正确的客户机和服务器；</p>
<p>2、HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，要比http协议安全，可防止数据在传输过程中不被窃取、改变，确保数据的完整性。</p>
<p>3、HTTPS是现行架构下最安全的解决方案，虽然不是绝对安全，但它大幅增加了中间人攻击的成本。</p>
<p>4、谷歌曾在2014年8月份调整搜索引擎算法，并称“比起同等HTTP网站，采用HTTPS加密的网站在搜索结果中的排名将会更高”。</p>
<h2 id="https的缺点："><a href="#https的缺点：" class="headerlink" title="https的缺点："></a>https的缺点：</h2><p>1、HTTPS协议握手阶段比较费时，会使页面的加载时间延长近50%</p>
<p>2、HTTPS连接缓存不如HTTP高效，会增加数据开销和功耗，甚至已有的安全措施也会因此而受到影响；</p>
<p>3、SSL证书需要钱，功能越强大的证书费用越高</p>
<p>4、SSL证书通常需要绑定IP，不能在同一IP上绑定多个域名</p>
<p>5、HTTPS协议的加密范围也比较有限，在黑客攻击、拒绝服务攻击、服务器劫持等方面几乎起不到什么作用。最关键的，SSL证书的信用链体系并不安全，特别是在某些国家可以控制CA根证书的情况下，中间人攻击一样可行。</p>
<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><p>知乎各位大佬的回答 <a href="https://www.zhihu.com/question/25539382" target="_blank" rel="noopener">https://www.zhihu.com/question/25539382</a><br>HTTP与HTTPS的区别  <a href="https://www.cnblogs.com/wqhwe/p/5407468.html" target="_blank" rel="noopener">https://www.cnblogs.com/wqhwe/p/5407468.html</a></p>
<p></p></div><div class="meta"><i class="iconfont iconweibiaoti--" title="阅读时长">4</i><i class="iconfont iconwenzi" title="字数">1.2k</i><i class="iconfont iconshijian" title="创建时间">2018-10-16 14:38</i></div></article><article><a class="artititle" href="/2018/10/10/mysql/">mysql常用语句</a><div class="content ellipse"><p></p><p>sql语法特点：</p>
<ul>
<li>没有””双引号，字符串使用’’单引号包含；</li>
<li>没有逻辑相等，赋值和逻辑相等都是=；</li>
<li>类型不再是最严格的，任何数据都可以包含在’’单引号内；</li>
<li>没有布尔值的概念，但是在视图中可以输入true/false；</li>
<li>它也有关系运算符：&gt; &lt; &gt;= &lt;= = &lt;&gt; !=，返回一个布尔值；</li>
<li>它也有逻辑运算符：！(not) &amp;&amp;(and) ||(or)；</li>
<li><p>它不区别大小写。</p>
</li>
<li><p>以下语句，user为表名, id,name,sex,card,phone,address为字段</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#数据库创建#</span></span><br><span class="line"><span class="string">"create database"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"drop table if exists user"</span></span><br><span class="line"><span class="comment"># 如果存在(if exists)就删除表</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果没有(if not exists)就新增表，设置id为主键，address为外键关联address表的id字段</span></span><br><span class="line"><span class="string">"""create table if not exists user(</span></span><br><span class="line"><span class="string">    id int auto_increment primary key,</span></span><br><span class="line"><span class="string">    name varchar(5),</span></span><br><span class="line"><span class="string">    sex  char(1),</span></span><br><span class="line"><span class="string">    card  char(18),</span></span><br><span class="line"><span class="string">    phone  char(11),</span></span><br><span class="line"><span class="string">    address varchar(30),</span></span><br><span class="line"><span class="string">    foreign key(address) references address(id))"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改自增长Id,数据库新增的数据会从1000开始但是原来的数据不会改变</span></span><br><span class="line"><span class="string">"alter table user auto_increment=1000"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 新增数据库表字段plus</span></span><br><span class="line"><span class="string">"alter table user add plus varchar(8)"</span></span><br><span class="line"><span class="comment"># --------------------------插入数据----------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># 数据插入时一定要注意 类型对应，数量对应，顺序对应</span></span><br><span class="line"><span class="comment"># 字符串值必须包含在''以内，赋值可以使用default,null</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 插入单条数据，如果不列出字段名mysql会按照顺序添加</span></span><br><span class="line"><span class="string">"""insert into user(name, sex, id_card, phone, address)</span></span><br><span class="line"><span class="string">        values ('李四', '女', '511569845612354879', '10086', '太古里77号')"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 批量插入数据</span></span><br><span class="line"><span class="string">"""insert into user(name, sex, id_card, phone, address)</span></span><br><span class="line"><span class="string">        values (%s, %s, %s, %s, %s)"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------------------查询数据--------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># order by 对查询结果进行排序 select 字段1,字段2,字段3 from 表名 order by 字段 desc(降序)||asc(升序)</span></span><br><span class="line"><span class="string">"select address,id from user order by id desc"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 去重复查询 select distinct 字段 from 表名</span></span><br><span class="line"><span class="string">"select distinct address from user"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 分页查询 limit select 字段1，字段2 from 表名 limit 初始位置，记录数</span></span><br><span class="line"><span class="string">"select id, name, sex, id_card from user limit 3,6"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 精准查询 in 只查找括号内的数据； not in 则相反</span></span><br><span class="line"><span class="string">"select * from user where ID in (1001,1003)"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 精准查询 between and 查找1001-1003范围内的数据；not between and 相反</span></span><br><span class="line"><span class="string">"select * from user where ID between 1001 and 1003"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 模糊查询 like (% 代表任意字符 _ 代表单个字符)；not like相反</span></span><br><span class="line"><span class="string">"select * from user where name like '_麻%'"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 多条件查询 and 关键字</span></span><br><span class="line"><span class="string">"select * from user where sex='女' and address='太古里77号'"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 多条件查询 or 关键字 只需满足一个条件</span></span><br><span class="line"><span class="string">"select * from user where name='王麻子子' or address='太古里77号' "</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 多表查询，两个表comment，movie</span></span><br><span class="line"><span class="comment"># 语法：select * from 表1(左表) left join 表2(右表) on 表2.字段 = 表1.字段</span></span><br><span class="line"><span class="string">"select * from comment left join movie on movie.id = comment.movieid"</span></span><br><span class="line"><span class="comment"># inner join / join单独用   返回所有匹配的行</span></span><br><span class="line"><span class="comment"># left join     不论是否匹配会返回“left join”左边表所有的行，匹配不上的字段为null</span></span><br><span class="line"><span class="comment"># right join    和left join相反，会返回右边表的所有的行</span></span><br><span class="line"><span class="comment"># full join     只要存在一条匹配就会返回两个表所有的行</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ------删除数据和更新数据 or,and,between and,like等关键字可以查询到多条数据然后批量删除或者更新-------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除数据</span></span><br><span class="line"><span class="comment">#delete [from] 表名 where 条件</span></span><br><span class="line"><span class="string">"delete from user where name='王麻子子' or address='太古里77号'"</span></span><br><span class="line"><span class="comment"># 数据库清空</span></span><br><span class="line"><span class="string">"truncate table user"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新数据</span></span><br><span class="line"><span class="string">"update user set name = '更新' where ID in (1005,1006)"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><p><a href="https://www.cnblogs.com/esofar/p/6185210.html" target="_blank" rel="noopener">https://www.cnblogs.com/esofar/p/6185210.html</a> 史上最全的MSSQL复习笔记</p>
<p></p></div><div class="meta"><i class="iconfont iconweibiaoti--" title="阅读时长">3</i><i class="iconfont iconwenzi" title="字数">848</i><i class="iconfont iconshijian" title="创建时间">2018-10-10 17:36</i></div></article><article><a class="artititle" href="/2018/10/09/node_fromdata/">nodejs之接收formdata表单</a><div class="content ellipse"><p></p><p>最近在学习express，写一个vue+express+mysql的小demo，需要上传一张封面图和一些其他的表单字段….</p>
<h1 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h1><p>formdata主要用于发送表单数据，将数据编译成键值对的形式使用XMLHttpRequest来发送，一般的请求通常使用序列化的方法发送formdata格式的数据，所以formdata对象比较常见的应用场景是发送文件或者通过HTML表单创建的formdata对象用以发送表单<br><strong> 那么使用express搭建的nodejs的后台如何获取前台发送的formdata格式的数据 </strong></p>
<h1 id="Multer中间件"><a href="#Multer中间件" class="headerlink" title="Multer中间件"></a>Multer中间件</h1><p>Multer 是一个 node.js 中间件，用于处理 multipart/form-data 类型的表单数据</p>
<p>首先安装并存储在packjson中<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span> <span class="comment">--save multer</span></span><br></pre></td></tr></table></figure></p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>Multer 需要接受一个 options 对象，用于对文件上传时做一些控制，比如文件存储，大小限制等<br>所以在路由文件中除了引入 multer 模块还要设置 options 对象</p>
<ul>
<li><p>dest or storage: 在哪里存储文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一般情况下只要设置 dest 属性设置文件存储的位置</span></span><br><span class="line"><span class="keyword">var</span> multer  = <span class="built_in">require</span>(<span class="string">'multer'</span>)</span><br><span class="line"><span class="keyword">var</span> upload = multer(&#123; <span class="attr">dest</span>: <span class="string">'uploads/'</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="string">"但如果你想要设置更多,那么需要使用storage代替dest"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> storage = multer.diskStorage(&#123;<span class="comment">// 磁盘存储引擎可以让你控制文件的存储</span></span><br><span class="line">  destination: <span class="function"><span class="keyword">function</span> (<span class="params">req, file, cb</span>) </span>&#123;</span><br><span class="line">    cb(<span class="literal">null</span>, <span class="string">'/tmp/my-uploads'</span>) <span class="comment">// 文件存储路径</span></span><br><span class="line">  &#125;,</span><br><span class="line">  filename: <span class="function"><span class="keyword">function</span> (<span class="params">req, file, cb</span>) </span>&#123;</span><br><span class="line">    cb(<span class="literal">null</span>, file.fieldname + <span class="string">'-'</span> + <span class="built_in">Date</span>.now()) <span class="comment">// 文件名称</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">var</span> upload = multer(&#123; <span class="attr">storage</span>: storage &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>fileFilter: 文件过滤器，控制哪些文件可以被接受,接收一个函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fileFilter</span> (<span class="params">req, file, cb</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 你可以通过判断file的参数来判断这个文件是否跳过或者上传以及报错</span></span><br><span class="line">  <span class="comment">// 拒绝这个文件</span></span><br><span class="line">  cb(<span class="literal">null</span>, <span class="literal">false</span>)</span><br><span class="line">  <span class="comment">// 接受这个文件</span></span><br><span class="line">  cb(<span class="literal">null</span>, <span class="literal">true</span>)</span><br><span class="line">  <span class="comment">// 发送一个错误:</span></span><br><span class="line">  cb(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'I don\'t have a clue!'</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>limits: 限制上传的数据，接受一个对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"fieldNameSize"</span>	<span class="comment">// field 名字最大长度	100 bytes</span></span><br><span class="line">  <span class="string">"fieldSize"</span>	<span class="comment">// field 值的最大长度	1MB</span></span><br><span class="line">  <span class="string">"fields"</span>	<span class="comment">// 非文件 field 的最大数量	无限</span></span><br><span class="line">  <span class="string">"fileSize"</span>	<span class="comment">// 在 multipart 表单中，文件最大长度 (字节单位)	无限</span></span><br><span class="line">  <span class="string">"files"</span>	<span class="comment">// 在 multipart 表单中，文件最大数量	无限</span></span><br><span class="line">  <span class="string">"parts"</span>	<span class="comment">// 在 multipart 表单中，part 传输的最大数量(fields + files)	无限</span></span><br><span class="line">  <span class="string">"headerPairs"</span>	<span class="comment">// 在 multipart 表单中，键值对最大组数	2000</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><ul>
<li><p>.single(fieldname)接受一个参数名为fieldname的文件<br>应用场景：单个文件上传 + 一些其他的表单字段</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">'/profile'</span>, upload.single(<span class="string">'avatar'</span>), <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// req.file 是 `avatar` 文件的信息</span></span><br><span class="line">  <span class="comment">// req.body 将具有文本域数据，如果存在的话</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>.array(fieldname, maxCount) 接受一个参数名为fieldname的文件数组, 可选参数maxcount限制上传的最大数量<br>应用场景：适合参数名相同的多文件上传 + 一些其他的表单字段</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">'/photos/upload'</span>, upload.array(<span class="string">'photos'</span>, <span class="number">12</span>), <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// req.files 是 `photos` 文件数组的信息</span></span><br><span class="line">  <span class="comment">// req.body 将具有文本域数据，如果存在的话</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>.fields(fields) 接受一个对象数组<code>[{name:&quot;&quot;,maxCount: 1},]</code>，每个对象应该具有 name 和可选的 maxCount 属性,<br>应用场景：适合参数名不同的多文件上传 + 一些其他的表单字段</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cpUpload = upload.fields([&#123; <span class="attr">name</span>: <span class="string">'avatar'</span>, <span class="attr">maxCount</span>: <span class="number">1</span> &#125;, &#123; <span class="attr">name</span>: <span class="string">'gallery'</span>, <span class="attr">maxCount</span>: <span class="number">8</span> &#125;])</span><br><span class="line">app.post(<span class="string">'/cool-profile'</span>, cpUpload, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// req.files 是一个对象 (String -&gt; Array) 键是文件名，值是文件数组</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// 例如：</span></span><br><span class="line">  <span class="comment">//  req.files['avatar'][0] -&gt; File</span></span><br><span class="line">  <span class="comment">//  req.files['gallery'] -&gt; Array</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// req.body 将具有文本域数据，如果存在的话</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>.none() 只接受文本域</p>
</li>
<li><p>.any() 接受一切。文件数组将保存在 req.files。</p>
</li>
</ul>
<h1 id="代码参考"><a href="#代码参考" class="headerlink" title="代码参考"></a>代码参考</h1><p>在demo中的应用场景，很简单的单张图片上传+其他表单字段<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">"express"</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"><span class="keyword">var</span> multer = <span class="built_in">require</span>(<span class="string">"multer"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> storage = multer.diskStorage(&#123; </span><br><span class="line">  destination: <span class="function"><span class="keyword">function</span>(<span class="params">req, file, cb</span>) </span>&#123;</span><br><span class="line">    cb(<span class="literal">null</span>, <span class="string">"img"</span>); </span><br><span class="line">  &#125;,</span><br><span class="line">  filename: <span class="function"><span class="keyword">function</span>(<span class="params">req, file, cb</span>) </span>&#123;</span><br><span class="line">     <span class="comment">// Multer 不会为你添加任何扩展名，所以完整的名字需要我们自己拼接</span></span><br><span class="line">    cb(<span class="literal">null</span>, <span class="built_in">Date</span>.now() + <span class="string">"."</span> + file.originalname.split(<span class="string">"."</span>)[<span class="number">1</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> limits = &#123; </span><br><span class="line">  files: <span class="number">1</span>, <span class="comment">// 只接收一个文件</span></span><br><span class="line">  fileSize: <span class="number">2097152</span> <span class="comment">// 文件大小不超过2m </span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fileFilter</span>(<span class="params">req, file, cb</span>) </span>&#123; <span class="comment">// 文件类型判断</span></span><br><span class="line">  file.mimetype.split(<span class="string">"/"</span>)[<span class="number">0</span>] === <span class="string">"image"</span> ? cb(<span class="literal">null</span>, <span class="literal">true</span>) : cb(<span class="literal">null</span>, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> upload = multer(&#123;</span><br><span class="line">  storage: storage,</span><br><span class="line">  fileFilter: fileFilter,</span><br><span class="line">  limits: limits</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.post(<span class="string">"/insert"</span>, upload.single(<span class="string">"img"</span>), (req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    res.json(req.body);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>req.file获取到的参数<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fieldname: <span class="string">'img'</span>,  <span class="comment">// 表单字段名称</span></span><br><span class="line">originalname: <span class="string">'1.png'</span>, <span class="comment">// 上传时在用户电脑上的名称</span></span><br><span class="line">encoding: <span class="string">'7bit'</span>, <span class="comment">// 文件编码</span></span><br><span class="line">mimetype: <span class="string">'image/png'</span>, <span class="comment">// 文件类型</span></span><br><span class="line">destination: <span class="string">'/'</span>, <span class="comment">// 接受后的保存路径</span></span><br><span class="line">filename: <span class="string">'img-1539066538986'</span>, <span class="comment">// 保存在 destination 中的文件名	</span></span><br><span class="line">path: <span class="string">'\\img-1539066538986'</span>, <span class="comment">// 已上传文件的完整路径</span></span><br><span class="line">size: <span class="number">80419</span>  <span class="comment">// size</span></span><br></pre></td></tr></table></figure></p>
<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><p>express文档 <a href="http://www.expressjs.com.cn/4x/api.html#req.body" target="_blank" rel="noopener">http://www.expressjs.com.cn/4x/api.html#req.body</a><br>multer文档 <a href="https://github.com/expressjs/multer/blob/master/README.md" target="_blank" rel="noopener">https://github.com/expressjs/multer/blob/master/README.md</a></p>
<p></p></div><div class="meta"><i class="iconfont iconweibiaoti--" title="阅读时长">5</i><i class="iconfont iconwenzi" title="字数">1.2k</i><i class="iconfont iconshijian" title="创建时间">2018-10-09 14:31</i></div></article><article><a class="artititle" href="/2018/09/28/node_cors/">nodejs使用cors跨域</a><div class="content ellipse"><p></p><p>相关文章：<a href="https://tong-h.github.io/2017/12/01/Nginx%E7%9A%84%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E8%B7%A8%E5%9F%9F/" target="_blank" rel="noopener">Nginx的反向代理跨域</a></p>
<p>最近在学习express，遇到了跨域问题….</p>
<h1 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h1><p>CORS是一个W3C标准，全称是”跨域资源共享”（Cross-origin resource sharing）<br>跨域资源共享（ CORS ）机制允许 Web 应用服务器进行跨域访问控制，从而使跨域数据传输得以安全进行。浏览器支持在 API 容器中（例如 XMLHttpRequest 或 Fetch ）使用 CORS，以降低跨域 HTTP 请求所带来的风险。</p>
<h1 id="预检请求？"><a href="#预检请求？" class="headerlink" title="预检请求？"></a>预检请求？</h1><p>我自己在设置跨域的时候碰到的很多报错其实都是因为预检请求</p>
<p><strong> cors将请求场景分为 简单请求 和 非简单请求 </strong></p>
<p>简单请求：</p>
<ul>
<li>使用的方法是GET，HEAD，POST这三种之一</li>
<li>Content-Type 的值是text/plain、 multipart/form-data、 application/x-www-form-urlencoded 这三种之一</li>
</ul>
<p>那么浏览器检测到该请求非简单请求，会先发送一个预检请求到服务器，以获知服务器是否允许该实际请求</p>
<p>服务器会从预检请求拿到的以下3个信息去和服务器的Response的header对比，来决定是否允许该请求</p>
<ul>
<li>Access-Control-Request-Method ：实际请求的方法</li>
<li>Access-Control-Request-Headers：实际请求所携带的请求header字段</li>
<li>origin：实际请求的源站，域名</li>
</ul>
<h1 id="服务器header使用字段"><a href="#服务器header使用字段" class="headerlink" title="服务器header使用字段"></a>服务器header使用字段</h1><h2 id="Access-Control-Allow-Origin"><a href="#Access-Control-Allow-Origin" class="headerlink" title="Access-Control-Allow-Origin"></a>Access-Control-Allow-Origin</h2><p><strong> 必填字段，值：一个域名， *(表示接受任意域名的请求)，也可以读取请求headers中的origin字段 </strong></p>
<p>如果请求的源与该字段不符合服务器会返回一个正常的HTTP回应，状态码可能为200，但不会包含Access-Control-开头的Origin、Credentials、Headers3个字段，浏览器发现，回应的头信息没有包含Access-Control-Allow-Origin字段就会抛出一个错误，会被XMLHttpRequest的onerror回调函数捕获</p>
<h2 id="Access-Control-Request-Method"><a href="#Access-Control-Request-Method" class="headerlink" title="Access-Control-Request-Method"></a>Access-Control-Request-Method</h2><p><strong> 可选字段，表明服务器支持的所有跨域请求的方法 </strong></p>
<p>如果你用到除了HEAD，GET，POST之外的方法那么这个字段为必填</p>
<h2 id="Access-Control-Allow-Credentials-可选字段"><a href="#Access-Control-Allow-Credentials-可选字段" class="headerlink" title="Access-Control-Allow-Credentials 可选字段"></a>Access-Control-Allow-Credentials 可选字段</h2><p><strong> 该字段若存在便只能为true，表示服务器许可Cookie可以包含在请求中一起发给服务器 </strong></p>
<p>对于某些浏览器即使服务器为true，有时候也需要前端设置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.withCredentials = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>
<p>若为true Access-Control-Allow-Origin字段便不能为*，必须明确指定域名，Cookie遵循同源政策，只有用服务器域名设置的Cookie才会上传，且（跨源）原网页代码中的document.cookie也无法读取服务器域名下的Cookie。</p>
<h2 id="Access-Control-Allow-Headers"><a href="#Access-Control-Allow-Headers" class="headerlink" title="Access-Control-Allow-Headers"></a>Access-Control-Allow-Headers</h2><p><strong> 可选字段，设置Response的额外发送的header字段 </strong></p>
<p>CORS请求时，XMLHttpRequest对象的getResponseHeader()方法只能拿到6个基本字段：Cache-Control、Content-Language、Content-Type、Expires、Last-Modified、Pragma</p>
<p>如果想拿到其他字段，就必须在Access-Control-Expose-Headers里面指定。</p>
<h2 id="Access-Control-Max-Age"><a href="#Access-Control-Max-Age" class="headerlink" title="Access-Control-Max-Age"></a>Access-Control-Max-Age</h2><p><strong> 设置预警请求的结果能够被缓存多久，单位为秒 </strong></p>
<h1 id="express如何使用cors跨域"><a href="#express如何使用cors跨域" class="headerlink" title="express如何使用cors跨域"></a>express如何使用cors跨域</h1><p>在express种使用cors跨域是需要使用第三方模块<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span> <span class="comment">--save cors</span></span><br></pre></td></tr></table></figure></p>
<p>在app.js中写入以下设置<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">示例代码</span><br><span class="line">app.all(<span class="string">"*"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.header(<span class="string">"Access-Control-Allow-Credentials"</span>, <span class="string">"true"</span>);</span><br><span class="line">  res.header(<span class="string">"Access-Control-Allow-Headers"</span>,<span class="string">"Origin, X-Requested-With, Content-Type, Accept"</span>);</span><br><span class="line">  res.header(<span class="string">"Access-Control-Allow-Origin"</span>, req.headers.origin);</span><br><span class="line">  res.header(<span class="string">"Access-Control-Allow-Methods"</span>, <span class="string">"PUT,POST,GET,DELETE,OPTIONS"</span>);</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h1 id="参考文章："><a href="#参考文章：" class="headerlink" title="参考文章："></a>参考文章：</h1><p>HTTP访问控制（CORS） <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS</a></p>
<p>欢迎留言交流  (´▽`ʃ♡ƪ)</p>
<p></p></div><div class="meta"><i class="iconfont iconweibiaoti--" title="阅读时长">3</i><i class="iconfont iconwenzi" title="字数">858</i><i class="iconfont iconshijian" title="创建时间">2018-09-28 15:32</i></div></article><article><a class="artititle" href="/2018/09/20/vue3.0/">vue cli 3.0初体验</a><div class="content ellipse"><p></p><p><a href="https://medium.com/the-vue-point/plans-for-the-next-iteration-of-vue-js-777ffea6fabf" target="_blank" rel="noopener">尤雨溪：Vue 3.0 计划</a> 原文需翻墙<br><a href="https://juejin.im/post/5bb719b9f265da0ab915dbdd" target="_blank" rel="noopener">尤雨溪：Vue 3.0 计划</a> 掘金译文</p>
<h1 id="关于安装"><a href="#关于安装" class="headerlink" title="关于安装"></a>关于安装</h1><p>Vue CLI 的包名称由 vue-cli 改成了 @vue/cli<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">npm</span> install -g @vue/cli</span><br><span class="line"></span><br><span class="line">安装完成后查看版本</span><br><span class="line">vue --V</span><br></pre></td></tr></table></figure></p>
<h1 id="项目创建"><a href="#项目创建" class="headerlink" title="项目创建"></a>项目创建</h1><p>关于项目创建，除了命令创建3.x还增加了<strong>图形化界面创建以及管理vue项目</strong><br>在创建新项目时还可以<strong>混合选用多种集成</strong></p>
<ul>
<li>TypeScript</li>
<li>PWA</li>
<li>Vue Router &amp; Vuex</li>
<li>ESLint / TSLint / Prettier</li>
<li>用 Jest 或 Mocha 进行单元测试</li>
<li>用 Cypress 或者 Nightwatch 进行 E2E 测试</li>
</ul>
<h2 id="使用命令创建"><a href="#使用命令创建" class="headerlink" title="使用命令创建"></a>使用命令创建</h2><p>命令：vue create vueapp</p>
<p>1、使用上下箭头选择默认设置还是手动选择功能<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Vue CLI v3.0.3</span><br><span class="line">? Please pick a preset:</span><br><span class="line"> <span class="built_in"> default </span>(babel, eslint)</span><br><span class="line">&gt; Manually select features</span><br></pre></td></tr></table></figure></p>
<p>2、按空格键选择你需要的功能，选完后按回车<br><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">babel：javascript转译器，将最新版的js语法（es6、es7）转换为现阶段浏览器可以兼容的js代码</span><br><span class="line">typescript：使用 TypeScript 书写源码</span><br><span class="line">PWA：渐进式WEB应用</span><br><span class="line">Router：使用vue-router</span><br><span class="line">Vuex：使用vuex</span><br><span class="line">CSS Pre-processors：css预处理器</span><br><span class="line">Linter / Formatter：代码规范标准</span><br><span class="line"><span class="keyword">Unit</span> Testing：单元测试</span><br><span class="line">E2E Testing：e2e测试</span><br><span class="line">Vue CLI v3.<span class="number">0.3</span></span><br><span class="line">? Please pick a preset: Manually <span class="keyword">select</span> features</span><br><span class="line">? Check the features needed <span class="keyword">for</span> your project:</span><br><span class="line"> <span class="comment">(*) Babel</span></span><br><span class="line"><span class="comment"> ( ) TypeScript</span></span><br><span class="line"><span class="comment"> ( ) Progressive Web App (PWA) Support</span></span><br><span class="line"><span class="comment"> (*)</span> Router</span><br><span class="line"> <span class="comment">(*) Vuex</span></span><br><span class="line"><span class="comment">&gt;(*)</span> CSS Pre-processors</span><br><span class="line"> <span class="comment">(*) Linter / Formatter</span></span><br><span class="line"><span class="comment"> ( ) Unit Testing</span></span><br><span class="line"><span class="comment"> ( ) E2E Testing</span></span><br></pre></td></tr></table></figure></p>
<p>3、router是否使用history模式，history需要服务器支持详，情请看这儿<a href="https://router.vuejs.org/zh/guide/essentials/history-mode.html" target="_blank" rel="noopener">https://router.vuejs.org/zh/guide/essentials/history-mode.html</a><br>这里我就选no</p>
<p>4、css预处理器的选择，我习惯用sass</p>
<p>5、代码格式化检测选择，我用的是ide是vscode个人感觉搭配插件用着很舒服，所以我选Prettier</p>
<p>6、是否保存刚才的配置，下一次就不用重新配置了，我就直接回车</p>
<p>7、关于Babel, PostCSS, ESLint, etc.这些配置文件你是想放在package.json里面还是单独放在外面<br>编辑器一般默认会在项目根目录下寻找配置文件，这里我就直接回车选择In dedicated config files</p>
<p>8、是否保存为未来项目的预配置吗，我也是直接回车</p>
<p>最后配置如下<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Vue CLI v3.0.3</span><br><span class="line">? Please pick a preset: Manually select features</span><br><span class="line">? Check the features needed <span class="keyword">for</span> your project: Babel, Router, Vuex, CSS Pre-processors, Linter</span><br><span class="line">? Use history mode <span class="keyword">for</span> router? (Requires proper<span class="built_in"> server </span>setup <span class="keyword">for</span> index fallback <span class="keyword">in</span> production) <span class="literal">No</span></span><br><span class="line">? Pick a CSS pre-processor (PostCSS, Autoprefixer <span class="keyword">and</span> CSS Modules are supported by default): Sass/SCSS</span><br><span class="line">? Pick a linter / formatter config: Prettier</span><br><span class="line">? Pick additional lint features: Lint on save</span><br><span class="line">? Where <span class="keyword">do</span> you prefer placing<span class="built_in"> config </span><span class="keyword">for</span> Babel, PostCSS, ESLint, etc.? <span class="keyword">In</span> dedicated<span class="built_in"> config </span>files</span><br><span class="line">? Save this as a preset <span class="keyword">for</span> future projects? <span class="literal">Yes</span></span><br></pre></td></tr></table></figure></p>
<h2 id="图形化界面"><a href="#图形化界面" class="headerlink" title="图形化界面"></a>图形化界面</h2><p>图形化操作非常方便，我就不一步步演示了，主要懒得贴图 (°ー°〃)<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">执行npm命令</span><br><span class="line">vue ui</span><br><span class="line">访问 <span class="string">http:</span><span class="comment">//localhost:8000 你就可以创建，管理，导入项目</span></span><br></pre></td></tr></table></figure></p>
<h1 id="实用新功能"><a href="#实用新功能" class="headerlink" title="实用新功能"></a>实用新功能</h1><ul>
<li>node_modules</li>
<li>public</li>
<li>src</li>
<li>.browserslistrc</li>
<li>.eslintrc.js</li>
<li>.gitignore</li>
<li>babel.config.js</li>
<li>package.json</li>
<li>postcss.config.js</li>
<li>README.md</li>
</ul>
<p>以上是项目根目录，3.x对比2.x文件结构明显精简了不少，多了一个public文件夹用于存放静态文件少了config、build等一系列的配置文件，这些配置文件都被放在了node_modules\@vue文件下</p>
<h2 id="browserslist"><a href="#browserslist" class="headerlink" title="browserslist"></a>browserslist</h2><p>根目录中多了一个.browserslist文件，可以指定项目的目标浏览器的范围<br>用于转译的 JavaScript 特性和添加CSS 浏览器前缀，可以减少兼容代码提高代码质量<br>如果想少一个文件，你也可以在package.json中添加browserslist字段，参数是一个数组<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">这是默认设置，兼容所有最新版本，不支持ie8以下</span><br><span class="line">&gt; <span class="number">1</span>%</span><br><span class="line">last <span class="number">2</span> versions</span><br><span class="line">not ie &lt;= <span class="number">8</span></span><br></pre></td></tr></table></figure></p>
<p>使用 npx browserslist 可以查看项目的浏览器兼容情况<br>将需要支持的目标浏览器参数放在文件中就好</p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">&gt; 1%</td>
<td style="text-align:center">全球超过1%人使用的浏览器</td>
</tr>
<tr>
<td style="text-align:center">&gt; 5% in US</td>
<td style="text-align:center">使用美国使用情况统计，接受两个字母的<a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2#Officially_assigned_code_elements" target="_blank" rel="noopener">国家/地区代码</a></td>
</tr>
<tr>
<td style="text-align:center">&gt; 5% in my stats</td>
<td style="text-align:center">使用<a href="https://github.com/browserslist/browserslist#custom-usage-data" target="_blank" rel="noopener">自定义使用数据</a></td>
</tr>
<tr>
<td style="text-align:center">last 2 versions</td>
<td style="text-align:center">所有浏览器兼容到最后两个版本根据CanIUse.com追踪的版本</td>
</tr>
<tr>
<td style="text-align:center">Firefox ESR</td>
<td style="text-align:center">火狐最新版本</td>
</tr>
<tr>
<td style="text-align:center">Firefox &gt; 20</td>
<td style="text-align:center">指定版本范围</td>
</tr>
<tr>
<td style="text-align:center">not ie &lt;=8</td>
<td style="text-align:center">方向排除部分版本</td>
</tr>
<tr>
<td style="text-align:center">Firefox 12.1</td>
<td style="text-align:center">指定浏览器版本</td>
</tr>
<tr>
<td style="text-align:center">since 2013</td>
<td style="text-align:center">2013年之后发布的所有版本</td>
</tr>
</tbody>
</table>
<p>更多请查看官方文档</p>
<h2 id="vue-cli服务"><a href="#vue-cli服务" class="headerlink" title="vue-cli服务"></a>vue-cli服务</h2><p>在一个 Vue CLI 项目中，@vue/cli-service 安装了一个名为 vue-cli-service 的命令。<br>你可以在 npm scripts 中以 vue-cli-service、或者从终端中以 ./node_modules/.bin/vue-cli-service 访问这个命令<br> Vue CLI 项目有三个模式： development 模式用于启动，production 模式用于打包和e2e测试，test 模式用于unit测试<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">启动</span><br><span class="line">serve:vue-cli-service serve</span><br><span class="line"></span><br><span class="line">  -<span class="ruby">-open    在服务器启动时打开浏览器</span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line"><span class="ruby">  --copy    在服务器启动时将 URL 复制到剪切版</span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line"><span class="ruby">  --mode    指定环境模式 (默认值：development)</span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line"><span class="ruby">  --host    指定 host (默认值：<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>)</span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line"><span class="ruby">  --port    指定 port (默认值：<span class="number">8080</span>)</span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line"><span class="ruby">  --https   使用 https (默认值：<span class="literal">false</span>)</span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line"><span class="ruby">打包</span></span><br><span class="line"><span class="ruby"><span class="symbol">build:</span>vue-cli-service build</span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line"><span class="ruby">  --modern 使用现代模式构建应用，为现代浏览器交付原生支持的 ES2015 代码，并生成一个兼容老浏览器的包用来自动回退。</span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line"><span class="ruby">  --target 允许你将项目中的任何组件以一个库或 Web Components 组件的方式进行构建。更多细节请查阅构建目标。</span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line"><span class="ruby">  --report 和 --report-json 会根据构建统计生成报告，它会帮助你分析包中包含的模块们的大小</span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line"><span class="ruby">测试</span></span><br><span class="line"><span class="ruby">   <span class="symbol">test:</span> vue-cli-service <span class="symbol">test:</span>e2e  端到端测试</span></span><br><span class="line"><span class="ruby">         vue-cli-service <span class="symbol">test:</span>unit  单元测试</span></span><br></pre></td></tr></table></figure></p>
<h2 id="现代模式"><a href="#现代模式" class="headerlink" title="现代模式"></a>现代模式</h2><p>为了兼容那些不支持js新特性的浏览器我们需要Babel转译，但转译后的代码笨重冗长，这次3.x提供了一个现代模式<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx vue-cli-service build <span class="comment">--modern</span></span><br></pre></td></tr></table></figure></p>
<p>这个命令会产生两个应用的版本：一个现代版的包，面向支持 ES modules 的现代浏览器，另一个旧版的包，面向不支持的旧浏览器<br>而且不需要我们手动去部署和设置什么，简直很贴心</p>
<ul>
<li>现代版的包会通过 <code>&lt;script type=&quot;module&quot;&gt;</code> 在被支持的浏览器中加载；它们还会使用 <code>&lt;link rel=&quot;modulepreload&quot;&gt;</code> 进行预加载</li>
<li>旧版的包会通过 <code>&lt;script nomodule&gt;</code> 加载，并会被支持 ES modules 的浏览器忽略</li>
<li>一个针对 Safari 10 中 <code>&lt;script nomodule&gt;</code> 的修复会被自动注入<h2 id="插件的添加"><a href="#插件的添加" class="headerlink" title="插件的添加"></a>插件的添加</h2>在一个已经被创建好的项目中安装一个插件,使用vue add命令<h2 id="CLI-插件安装"><a href="#CLI-插件安装" class="headerlink" title="CLI 插件安装"></a>CLI 插件安装</h2>每个 CLI 插件都会包含一个 (用来创建文件的) 生成器和一个 (用来调整 webpack 核心配置和注入命令的) 运行时插件<br>对于这种cli插件需要加入@vue的前缀，这个命令将 @vue/eslint 解析为完整的包名 @vue/cli-plugin-eslint，然后从 npm 安装它，调用它的生成器<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">插件添加</span><br><span class="line">vue <span class="keyword">add</span><span class="bash"> @vue/eslint</span></span><br><span class="line"><span class="bash"></span></span><br><span class="line"><span class="bash">向被安装的插件传递生成器选项 (这样做会跳过命令提示)</span></span><br><span class="line"><span class="bash">vue add @vue/eslint --config airbnb --lintOn save</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="第三方插件安装"><a href="#第三方插件安装" class="headerlink" title="第三方插件安装"></a>第三方插件安装</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">安装并调用 vue-cli-plugin-apollo，不带 @vue 前缀，该命令会换作解析一个 unscoped 的包</span><br><span class="line">执行此命令后src里会创建一个plugins文件夹，里面会自动生成关于插件的配置文件</span><br><span class="line">vue <span class="keyword">add</span><span class="bash"> axios</span></span><br><span class="line"><span class="bash"></span></span><br><span class="line"><span class="bash">基于一个指定的 scope 使用第三方插件，如果一个插件名为 @foo/vue-cli-plugin-bar，你可以这样添加它：</span></span><br><span class="line"><span class="bash">vue add @foo/bar</span></span><br></pre></td></tr></table></figure>
<h1 id="配置修改"><a href="#配置修改" class="headerlink" title="配置修改"></a>配置修改</h1><p>例：向所有 Sass 样式传入共享的全局变量<br>在根目录新建一个vue.config.js，加入以下配置<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  css: &#123;</span><br><span class="line">    loaderOptions: &#123;</span><br><span class="line">      <span class="comment">// 给 sass-loader 传递选项</span></span><br><span class="line">      sass: &#123;</span><br><span class="line">        <span class="comment">// @/ 是 src/ 的别名</span></span><br><span class="line">        <span class="comment">// 所以这里假设你有 `src/variables.scss` 这个文件</span></span><br><span class="line">        data: <span class="string">`@import "@/variables.scss";`</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="打包后路径问题"><a href="#打包后路径问题" class="headerlink" title="打包后路径问题"></a>打包后路径问题</h1><p>在vue.config.js文件种加入’baseUrl: ‘./‘’<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    baseUrl: <span class="string">'./'</span></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>虽然官方说这个文件会被 @vue/cli-service 自动加载，但如果你启动项目用的是npm run serve，那么你最好使用npx vue-cli-service serve重启一下</p>
<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><p>官方文档 <a href="https://cli.vuejs.org/zh/guide/" target="_blank" rel="noopener">https://cli.vuejs.org/zh/guide/</a><br>browserslist的github <a href="https://github.com/browserslist/browserslist" target="_blank" rel="noopener">https://github.com/browserslist/browserslist</a><br><a href="https://mp.weixin.qq.com/s/hfr2Q3FXZFIdqM_r8HrLwQ" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/hfr2Q3FXZFIdqM_r8HrLwQ</a></p>
<p>欢迎留言交流  (´▽`ʃ♡ƪ)</p>
<p></p></div><div class="meta"><i class="iconfont iconweibiaoti--" title="阅读时长">8</i><i class="iconfont iconwenzi" title="字数">2.1k</i><i class="iconfont iconshijian" title="创建时间">2018-09-20 11:17</i></div></article><div id="paginator"><a class="extend prev" rel="prev" href="/archives/">Prev</a><a class="page-number" href="/archives/">1</a><span class="page-number current">2</span><a class="page-number" href="/archives/page/3/">3</a><a class="page-number" href="/archives/page/4/">4</a><a class="page-number" href="/archives/page/5/">5</a><a class="extend next" rel="next" href="/archives/page/3/">Next</a></div></div><script>document.getElementById('arshow').onclick = function() {
    document.getElementById('list_archives').style = 'opacity: 0;display: none'
    document.getElementById('normalposts').style = 'opacity: 0;display: block'
    setTimeout(() => {
        document.getElementById('normalposts').style.opacity = '1'                        
    }, 100);
}
document.getElementById('poshow').onclick = function() {
    document.getElementById('normalposts').style = 'opacity: 0;display: none'
    document.getElementById('list_archives').style = 'opacity: 1;display: block'
}</script></div><link rel="stylesheet" href="/css/partial/footer.css"><div class="footer"><p><span>Copyright © 2017 - 2019  </span><a href="http://www.beian.miit.gov.cn/">蜀ICP备19024124号</a></p><p>Powered by <a href="https://hexo.io/zh-cn/" target="_blank">Hexo</a> Theme by <a href="https://github.com/Tong-H/hexo-theme-energy" target="_blank">ENERGY</a></p><p><i class="iconfont iconchakan"><span>本站总访问量</span><span id="busuanzi_container_site_pv">  <span id="busuanzi_value_site_pv"></span> </span></i><i class="iconfont iconabout"><span>本站访客数</span><span id="busuanzi_container_site_uv">  <span id="busuanzi_value_site_uv"></span> </span></i></p></div></div></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>var _hmt = _hmt || [];(function(){var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?a4d08c5088ca0d4b18c14260c9ca89a1";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})()</script></body></html>